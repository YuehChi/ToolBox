{% extends "base_generic.html" %}
<!DOCTYPE html>
<html lang="en">
{% load static %}
<script src="/static/bootstrap/js/bootstrap.min.js"></script>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
{% block content %}
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>台大工具箱</title>
    <link rel="stylesheet" href="/static/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="/static/fonts/material-icons.min.css">
    <link rel="stylesheet" href="/static/css/take-styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="\static\js\report.js" type="text/javascript"></script>
</head>
<style>
    /* image */
    .img-circular{
        width: 43px;
        height: 43px;
        background-image: url('/static/images/default_icon_1.png');
        background-size: cover;
        display: block;
        border-radius: 100px;
        -webkit-border-radius: 100px;
        -moz-border-radius: 100px;
    }

    /* address style */
    a.link_title:link {
        color:rgba(134, 81, 64);
        text-decoration: none;
    }
    a.link_title:visited{
        color:rgba(134, 81, 64);

    }
    a.link_title:hover{
        color:rgb(204,195,190);
    }

    a.case_title:link{
        color: rgb(60,46,47);
        text-decoration: none;
    }
    a.case_title:visited{
        color: rgb(60,46,47);
    }

    a.case_title:hover{
        color: rgba(134, 81, 64);
    }

    /* star */
    .checked {
    color: #f6b902;
    }
    .unchecked {
    color: #f6b902;
    }
    .helfchecked {
    color: #f6b902;
    }

    fieldset, label { margin: 0; padding: 0; }
    
    h1 { font-size: 1.5em; margin: 10px; }
    
    /*  Style Star Rating Widget  */
    
    .rating { 
      border: none;
      float: left;
    }
    
    .rating > input { display: none; } 
    .rating > label:before { 
      margin: 0px;
      font-size: 16px;
      font-family: FontAwesome;
      display: inline-block;
      content: "\f005";
    }
    
    .rating > .half:before { 
      content: "\f089";
      position: absolute;
    }
    
    .rating > label { 
      color: #ddd; 
     float: right; 
    }
    
    /***** CSS Magic to Highlight Stars on Hover *****/
    
    .rating > input:checked ~ label, /* show gold star when clicked */
    .rating:not(:checked) > label:hover, /* hover current star */
    .rating:not(:checked) > label:hover ~ label { color: #f3d16d;  } /* hover previous stars in list */
    
    .rating > input:checked + label:hover, /* hover current star when changing rating */
    .rating > input:checked ~ label:hover,
    .rating > label:hover ~ input:checked ~ label, /* lighten current selection */
    .rating > input:checked ~ label:hover ~ label { color: #f3d16d;  } 
    @media screen and (min-width: 991px){
        .screenM{
            margin-right: 15px;
            margin-left: 15px;
        }
    }
    </style>
{% load static %}
<script src="\static\js\user.js" type="text/javascript"></script>
<link rel="stylesheet" href="\static\css\user.css">


</head>
<script >
    function changeImage(id) {
        var a = id
        var url = window.location.origin + "{% static 'images/Vector2.png' %}"

        if (document.getElementById(id).src == url){
            document.getElementById(id).src = "{% static 'images/Vector.png' %}";
            
        } else{
            document.getElementById(id).src = "{% static 'images/Vector2.png' %}";
        }
    }
    
    function changeTime(oriTime, ouputId, status){
        var yyyy = oriTime.split('年')[0]
        var mm = oriTime.split('年')[1].split('月')[0]
        var dd = oriTime.split('年')[1].split('月')[1].split('日')[0]
        var tt = oriTime.split('年')[1].split('月')[1].split('日 ')[1]
        if (mm.length == 1){
            mm = "0"+mm;
        }
        if (dd.length ==1){
            dd = "0"+dd
        }
        var today = yyyy + '/' + mm + '/' + dd
        var enddate = new Date(mm + '/' + dd + '/' + yyyy + ' '+ tt)
        var currentdate = new Date();
        var remainday = Math.abs((enddate.getTime() - currentdate.getTime()))

        if (status == "s"){
            document.getElementById(ouputId).innerHTML=today;
        }else if (status =="e"){
            document.getElementById(ouputId).innerHTML=today + "<span style='margin-left: 5px;color: rgb(60,46,47); font-size: 14px;'> 剩</span> <span style='font-size:16px;color: rgb(193, 106, 110)'>"+ msToTime(remainday)+" </span>";
        }else if (status =="user"){
            document.getElementById(ouputId).innerHTML="上次登入: "+ msToTime(remainday)+"前";
        }else{
            document.getElementById(ouputId).innerHTML="於 "+ today+ "<br>解除委託";
        }
    }
    function msToTime(ms) {
        let seconds = (ms / 1000).toFixed(0);
        let minutes = (ms / (1000 * 60)).toFixed(0);
        let hours = (ms / (1000 * 60 * 60)).toFixed(0);
        let days = (ms / (1000 * 60 * 60 * 24)).toFixed(0);
        if (seconds < 60) return seconds + "秒";
        else if (minutes < 60) return minutes + "分";
        else if (hours < 24) return hours + "<span style='font-size:14px'>小時</span>";
        else return days + "天"
    }
    function changePage(Page){
        if (Page == "publish_his"){
            document.getElementById("publish_his").style.display="";
            document.getElementById("publish").style.display="none";

            document.getElementById("publish_hisA").style.color="rgb(94, 73, 73)";
            document.getElementById("publishA").style.color="rgb(204,195,190)";
        }else{
            document.getElementById("publish").style.display="";
            document.getElementById("publish_his").style.display="none";

            document.getElementById("publish_hisA").style.color="rgb(204,195,190";
            document.getElementById("publishA").style.color="rgb(94, 73, 73)";
        }
        
    }

    function getStar(starId,value){
        if (value =="None"){
            value = 0;
        } 
        var stringA = "<span class='fa fa-star checked' style='font-size:16px'></span>"
        var stringB = "<span class='fa fa-star-o unchecked' style='font-size:16px'></span>"
        var stringC = "<span class='fa fa-star-half-o helfchecked' style='font-size:16px'></span>"
        var result = ""
        valueInt = parseInt(value)
        for (i = 0; i < valueInt; i++){
            result= result+stringA
        }
        if ((value-valueInt)!=0){
            result= result+stringC
        }
        var los = 5-Math.ceil(value)
        for(j = 0; j<los; j++){
            result = result+stringB
        }

        document.getElementById(starId).innerHTML=result
    }
    // copy

    function copy(id){
        var r = document.createRange();
        r.selectNode(document.getElementById(id));
        window.getSelection().removeAllRanges();
        window.getSelection().addRange(r);
        document.execCommand('copy');
        window.getSelection().removeAllRanges();
    }
    
</script>
<body style="background: rgb(244,244,243);">
    <!-- report modal -->
    <div class="modal fade" id="reportModal" tabindex="10" aria-labelledby="reportModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="reportModalLabel">檢舉工具人</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <form action="{% url 'create-report' %}" method="POST">
                {% csrf_token %}
                {# 用不可變的input發送檢舉目標 [!]需要用js在modal彈出時填入 #}
                <div class="mb-3">
                    <label for="reported-case" class="col-form-label">被檢舉的案件</label>
                    <input type="text" id="report_case" name="reported_case" class="form-control" readonly>
                </div>
                <div class="mb-3">
                    <label for="reported_obj" class="col-form-label">被檢舉人</label>
                    <input type="text" id="report_user" name="reported_user" class="form-control" readonly>
                </div>
                <div class="mb-3">
                  <label for="report-type" class="col-form-label">檢舉類型:</label>
                  {# <input type="text" class="form-control" id="report-type"> #}
                  {# 用選單選擇檢舉類型 #}
                  <select class="form-control" id="report-type" name="report_type">
                  {% for type in reportTypes %}
                    <option value="{{ type.report_type_id }}">
                        {{ type.report_type_name }}
                    </option>
                  {% endfor %}
                  </select>
                </div>
                <div class="mb-3">
                  <label for="report-message" class="col-form-label">檢舉內容:</label>
                  <textarea class="form-control" id="report-message" name="description"></textarea>
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
              <button type="button" class="btn btn-primary">送出</button>
            </div>
          </div>
        </div>
    </div>
    <!-- --------Image Board-------- -->
    <div class="container" style="margin-top: 50PX;height: 100px;width: 100%;margin-right: 0px;margin-left: 0px;padding-right: 0px;padding-left: 0px;max-width: none;">
        <div class="row" style="height: 100px;width: 100%;margin: 0px;">
            <div class="col" style="height: 100px;width: 100%;padding: 0px;"><img src="\static\images\ntu_1.png" style="width: 100%;height: 100px;"></div>
        </div>
    </div>
    <div class="container-fuild">
        <div class="screenM row">
            <!-- style="margin-right: 15px;margin-left: 15px;" -->
            <div class="d-none d-lg-block col-sm-2">
                <div class="justify-content-center " style="margin-top: 30px;">
                    <ul class="list-group borderless rounded" style="font-size: 18px;line-height: 30px; text-align: center;display:block; box-shadow: 2px 2px rgba(196, 190, 190, 0.81);">
                        <li class="list-group-item member " m="1" style="height: 50px;"><a class="link_title" href="{%url 'my-user-profile'%}" >會員中心</a></li>
                        <li class="list-group-item bold" style="height: 50px;"><span style="font-weight:bold; color:rgba(134, 81, 64);">➤ </span><a class="link_title" href="{%url 'user-publish-record'%}" >我的委託</a><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></li>
                        <li class="list-group-item" style="height: 50px;"><a class="link_title" href="{%url 'user-take-record'%}">我的接案</a></li>
                        <li class="list-group-item" style="height: 50px;"><a class="link_title" href="{% url 'user-password-update' %}" >更改密碼</a></li>
                        <li class="list-group-item" style="height: 50px;"><a class="link_title" href="{% url 'logout' %}">登出</a></li>
                    </ul>
                </div>
            </div>

            <div class="col-md-10" style="margin-top: 30px; ">
                {% load static %}
                <div class="border rounded" style="background: #ffffff; box-shadow: 2px 3px rgba(196, 190, 190, 0.81);">
                    <h1 class="fw-bold text-center" style="height: 80px; margin-top: 40px; padding-top: 20px; background-repeat: no-repeat; background-position: 46%, center; background-image: url('{% static 'images/Ellipse%204.png' %}');  color: rgb(94, 73, 73);font-size: 30px;">我的委託</h1>
                    
                    
                    <div class="position-relative underlineEffects" style="margin-top: -50px;">
                        <ul style="margin-left: 40px;margin-bottom: 20px;">
                            <li><a id="publishA" href="javascript:void(0);" onclick="changePage('publish');" style="color: rgb(94, 73, 73);">我的委託</a></li>
                            <li><a id="publish_hisA" href="javascript:void(0);" onclick="changePage('publish_his');">歷史紀錄</a></li>
                        </ul>
                        <!-- <div class="d-none d-xl-block position-absolute top-0 end-0" style="width: 300px; margin-top: 30px;">
                            <span style="margin-left: 28px;color: rgb(94, 73, 73);font-size: 14px;">篩選</span>
                            <div class="dropdown" style="width: 166px;margin-left: 72px;margin-top: -24px;"><button class="btn btn-primary dropdown-toggle" aria-expanded="false" data-bs-toggle="dropdown" type="button" style="height: 24px;background: rgb(232,231,229);font-size: 16px;text-align: right;line-height: 8.5px;border-style: none;width: 160.125px;"></button>
                                <div class="dropdown-menu" style="font-size: 12px;text-align: justify;"><a class="dropdown-item" href="#" style="color: rgb(94,73,73);">按發布時間</a><a class="dropdown-item" href="#" style="color: rgb(94,73,73);">按結束時間</a><a class="dropdown-item" href="#" style="color: rgb(94,73,73);">按狀態</a></div>
                            </div>
                        </div> -->
                    </div>
<!-- publish -->
                    <div id="publish">
                        <div class="d-none d-xl-block table-responsive" style="margin-top: 5px;">
                            <table class="table table-borderless">
                                <tbody>
                                    <tr>
                                        <td style="width: 80px;"></td>
                                        <td style="width: 200px;">↓ 發布時間</td>
                                        <td style="padding-left: 40px; width: 580px;">標題</td>
                                        <td style="width: 370px;">結束時間</td>
                                        {% load static %}
                                        <td class="d-block" style="width: 130px;">狀態<button type="button" class="btn btn-sm" data-bs-toggle="tooltip" data-bs-placement="right" title="Hooray!"style="background: rgba(13,110,253,0);color: rgb(38, 29, 29);border-style: none;width: 30px;height: 30px;padding: 0px 0px;margin-top: -4px;"><img src="{% static 'images/Help.png' %}"></button></td>

                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="table-responsive" style="margin-top: -19px; margin-left: 40px;margin-right: 40px;margin-bottom: 50px;background: #e2dad4;border-radius: 27px;border: 1px solid rgb(125,105,105);">
                            <!-- <div > -->
                                <table class="table table-borderless" style="margin-top: 7px;">
                                    {% for case in case_list %}
                                    {% if case.case_status.status_name in '徵求,進行' %}
                                    <tbody>
                                        {% for key, value in number.items %}
                                            {% if key == case.case_id %}
                                            
                                            <tr>
                                                {% load static %}
                                                
                                                <td style="width: 80px;padding-right: 0px;padding-left: 20px;padding-bottom: 0px;">
                                                    <button id="B{{ case.case_id }}" class="btn btn-primary" onclick="changeImage('{{ case.case_id }}')" type="button" data-bs-toggle="collapse" data-bs-target="#M{{ case.case_id }}" aria-expanded="false" aria-controls="M{{ case.case_id }}"  style="background: rgba(13,110,253,0);color: rgb(38, 29, 29);border-style: none;">
                                                        <img id="{{ case.case_id }}" src="{% static 'images/Vector2.png' %}">
                                                    </button>
                                                </td>
                                                <td style="line-height: 35px;color: rgb(121, 110, 110);width: 150px;padding-bottom: 0px;" id="creatdate{{ case.case_id }}">
                                                    {{case.created_datetime}}
                                                    <script> 
                                                        var oriTime = "{{case.created_datetime}}"
                                                        var ouputId = "creatdate{{ case.case_id }}"
                                                        changeTime(oriTime, ouputId, "s");
                                                    </script>
                                                </td>
                                                <td style="width: 30px; padding-top: 12px;padding-right: 0px;padding-left: 0px;">
                                                    {% if value == 0 %}
                                                    {% comment %}{% endcomment %}
                                                        <button class="btn btn-primary" type="button" onclick="window.location='/toolfamily/case/profile/{{case.case_id}}/edit/'" style="background: rgba(13,110,253,0);color: rgb(38, 29, 29);border-style: none;width: 30px;height: 30px;padding: 0px 0px;margin-top: -4px;">
                                                            {% load static %}
                                                            <img src="{% static 'images/Mode%20edit.png' %}" style="margin-right: 30px;">
                                                        </button>
                                                        {% else %}
                                                    {% endif %}
                                                </td>
                                                <td  style="width: 550px;"><a class="case_title" href="{% url 'case-profile' case.case_id %}" style="line-height: 35px;padding-bottom: 0px;">{{case.title}}</a></td>
                                                
                                            
                                                <td  style="width: 420px;line-height: 34px;color: rgb(121, 110, 110); padding-bottom: 0px;" id="enddate{{ case.case_id }}">
                                                    {{case.ended_datetime}}
                                                    <script> 
                                                        var oriTime = "{{case.ended_datetime}}"
                                                        var ouputId = "enddate{{ case.case_id }}"
                                                        changeTime(oriTime, ouputId ,"e");
                                                    </script>
                                                </td>
                                                
                                                <td class="d-block" style="width: 120px;line-height: 34px;color: rgb(61,46,47);padding-bottom: 0px;">
                                                    {% if value == 0 %}
                                                        徵求中 <span style="font-size: 10px;">(需{{case.num}}人)</span>
                                                    {% else %}
                                                        委託中 ({{value}}/{{case.num}})
                                                    {% endif %}
                                                </td>
                                            </tr>
                                            <tr>
                                                <td colspan="9" style="padding-left: 0px;padding-right: 0px;padding-top: 0px;padding-bottom: 0px; ">
                                                    <div class="collapse" id="M{{ case.case_id }}">
                                                        <div class="table-responsive">
                                                            <table class="table table-borderless">
                                                                <tbody>
                                                                    <tr>
                                                                        <td colspan="7" style="background: #f4f4f3;color: rgb(134,81,64);">&nbsp; &nbsp; &nbsp;已選名單</td>
                                                                        {% load static %}
                                                                        <td style="width: 140px; text-align: center; color: rgb(134,81,64);background: #f4f4f3;">|<img src="{% static 'images/People.png' %}" style="width: 18px;margin-left: 4px;">
                                                                            <a class="link_title" href="{% url 'user-publish-applicant' case.case_id %}" style="font-size: 15px;">應徵名單({% for key1, value1 in willing.items %}
                                                                            {% if key1 == case.case_id %}{{value1}}{% endif %}
                                                                        {% endfor %})</a></td>
                                                                    </tr>
                                                {% endif %}
                                            {% endfor %}
                                                                    {% for record,canReport in record_list %}
                                                                        {% if record.case == case %}
                                                                        <tr style="font-size: 12px;background: #ffffff;">
                                                                            <td style="width: 50px; padding-top: 15px;padding-bottom: 10px;padding-left: 30px;">
                                                                                {% if record.commissioned_user.icon %}
                                                                                    <div class="img-circular" style="background-image: url({{record.commissioned_user.icon.url}});"></div>
                                                                                    <!-- <img class="img-circular" src="{{record.commissioned_user.icon.url}}" style="width: 43px; background-color: #ca6c38;"> -->
                                                                                {% else %}
                                                                                    {% load static %}
                                                                                    <div class="img-circular"></div>
                                                                                    <!-- <img  class="img-circular" src="{% static 'images/default_icon_1.png' %}" style="width: 43px;background-color: #ca6c38;"> -->
                                                                                {% endif %}
                                                                            </td>
                                                                            <td class="d-inline-block" style="padding-top: 10px;width:150px;">
                                                                                {% comment %}
                                                                                {% url 'others-user-profile' record.commissioned_user.user_id %}
                                                                                {% endcomment %}
                                                                                <a class="link_title" href="{% url 'others-user-profile' record.commissioned_user.user_id %}" style="line-height: 20px;">
                                                                                    {% if record.commissioned_user.nickname != "" %}
                                                                                        {{record.commissioned_user.nickname}}
                                                                                    {% else %}
                                                                                        {{record.commissioned_user.name}}
                                                                                    {% endif %}
                                                                                    {% load static %} 
                                                                                    {% if record.commissioned_user.gender == 0 %}
                                                                                        {% load static %}
                                                                                        <img  style="width: 18px;"src="{% static 'images/gender-female.png' %}" style="margin-left: 10px;">
                                                                                    {% elif record.commissioned_user.gender == 1 %}
                                                                                        {% load static %}
                                                                                        <img style="width: 18px;"src="{% static 'images/gender-male.png' %}" style="margin-left: 10px;">
                                                                                    {% else %}
                                                                                        {% load static %}
                                                                                        <img style="width: 18px;"src="{% static 'images/gender-male-female.png' %}" style="margin-left: 10px;">
                                                                                    {% endif %}
                                                                                </a>
                                                                                <div class="w-100">
                                                                                    <span style="color: rgb(142,145,147);font-size: 12px;line-height: 0px;" id="p{{record.commissioned_user.account_mail}}{{ case.case_id }}">上次登入: {{record.commissioned_user.django_user.last_login}}
                                                                                        <script> 
                                                                                            var oriTime = "{{record.commissioned_user.django_user.last_login}}"
                                                                                            var ouputId = "p{{record.commissioned_user.account_mail}}{{ case.case_id }}"
                                                                                            changeTime(oriTime, ouputId ,"user");
                                                                                        </script>
                                                                                    </span>
                                                                                </div>
                                                                            </td>
                                                                            <td colspan="3" id="contact{{record.commissioned_user.account_mail}}{{ case.case_id }}" style="line-height: 55px;width: 350px;color: rgb(85,58,58);">
                                                                                {% if contact != None %}
                                                                                    {{record.commissioned_user.contact}}
                                                                                {% else %}
                                                                                    {{record.commissioned_user.account_mail}}
                                                                                {% endif %}
                                                                                {% load static %}
                                                                                <!-- copy -->
                                                                                <!-- <button onclick="copy('contact{{record.commissioned_user.account_mail}}{{ case.case_id }}')" class="btn btn-primary" type="button" style="background: rgba(13,110,253,0);color: rgb(38, 29, 29);border-style: none;width: 30px;height: 30px;padding: 0px 0px;margin-top: -4px;"><img src="{% static 'images/Content%20copy.png' %}"></button> -->
                                                                                <button onclick="copy('contact{{record.commissioned_user.account_mail}}{{ case.case_id }}')" class="btn btn-primary d-none d-lg-block" type="button" style="background: rgba(13,110,253,0);color: rgb(38, 29, 29);border-style: none;width: 30px;height: 30px;margin-top: -46px;margin-left: 110px;"><img src="{% static 'images/Content%20copy.png' %}"></button>
                                                                            </td>
                                                                             <!-- 追蹤、檢舉 -->
                                                                             <td style="width: 30px;line-height: 48px;">
                                                                                {% if canReport %}
                                                                                    <button class="btn "id="button-user-report" type="button" data-bs-toggle="modal" data-bs-target="#reportModal" data-user="{{ record.commissioned_user.user_id }}" data-case="{{ case.case_id }}"style="background: rgba(13,110,253,0);color: rgb(38, 29, 29);border-style: none;width: 30px;padding: 0px 12px;padding-right: 0px;padding-left: 0px;height: 30px;"><img src="{% static 'images/Report%20problem.png' %}" style="padding-top: 0px;"></button>
                                                                                {% else %}
                                                                                    <button class="btn justify-content-center align-items-center" disabled="disabled" id="button-user-report" type="button">
                                                                                        <i class="material-icons" style="font-size: 16px;">report_problem</i>
                                                                                        已檢舉
                                                                                    </button>
                                                                                    <!-- <button class="btn "id="button-user-report" type="button" data-bs-toggle="modal" data-bs-target="#reportModal" data-user="{{ record.commissioned_user.user_id }}" data-case="{{ case.case_id }}"style="background: rgba(13,110,253,0);color: rgb(38, 29, 29);border-style: none;width: 30px;padding: 0px 12px;padding-right: 0px;padding-left: 0px;height: 30px;"><img src="{% static 'images/Report%20problem.png' %}" style="padding-top: 0px;"></button> -->
                                                                                {% endif %}
                                                                            </td>
                                                                            {% if record.user_status.status_id == 2 %}
                                                                                <td class="d-block"style="width: 150px;text-align: center;"></td>
                                                                                <td style="line-height: 30px;text-align: center;">
                                                                                    <button class="btn btn-primary" type="button" disabled="disabled" style="width: 120px;height: 24px;font-size: 12px;line-height: 10px;background: #ca6c38;border-style: none;">完成</button>
                                                                                    <button class="btn btn-primary" type="button" onclick="window.location='/toolfamily/user/delete/{{record.commissionrecord_id}}'" style="width: 127.2812px;height: 24px;margin-top: 6px;font-size: 12px;line-height: 10px;border-color: #7b3b20;background: rgba(13,110,253,0);color: #7b3b20;">解除</button>
                                                                                </td>
                                                                            {% elif record.user_status.status_id == 3 %}
                                                                                <td class="align-middle d-block" style="text-align: center;width: 150px; color: rgb(85,58,58);" >
                                                                                    {% if record.rate_publisher_to_worker %}
                                                                                    <br>
                                                                                        <span id="star{{record.commissioned_user.account_mail}}{{ case.case_id }}">
                                                                                            <script>
                                                                                                var starId = "star{{record.commissioned_user.account_mail}}{{ case.case_id }}"
                                                                                                var value = "{{record.rate_publisher_to_worker}}"
                                                                                                getStar(starId, value );
                                                                                            </script>
                                                                                        </span>&nbsp; 評價
                                                                                    {% else %}
                                                                                    <br>
                                                                                        <form action="/toolfamily/user/rate/" method="post" style="margin-left: 10px;"onSubmit="return confirm('確定送出評價？');" >
                                                                                            <label>評價</label>
                                                                                            {% csrf_token %}
                                                                                            <fieldset class="rating">
                                                                                                <input type="submit" id="field{{record.commissioned_user.account_mail}}{{ case.case_id }}_star5" name="{{record.commissionrecord_id}}" value="5" /><label class = "full" for="field{{record.commissioned_user.account_mail}}{{ case.case_id }}_star5"></label>
                                                                                                <input type="submit" id="field{{record.commissioned_user.account_mail}}{{ case.case_id }}_star4" name="{{record.commissionrecord_id}}" value="4" /><label class = "full" for="field{{record.commissioned_user.account_mail}}{{ case.case_id }}_star4"></label>
                                                                                                <input type="submit" id="field{{record.commissioned_user.account_mail}}{{ case.case_id }}_star3" name="{{record.commissionrecord_id}}" value="3" /><label class = "full" for="field{{record.commissioned_user.account_mail}}{{ case.case_id }}_star3"></label>
                                                                                                <input type="submit" id="field{{record.commissioned_user.account_mail}}{{ case.case_id }}_star2" name="{{record.commissionrecord_id}}" value="3" /><label class = "full" for="field{{record.commissioned_user.account_mail}}{{ case.case_id }}_star2"></label>
                                                                                                <input type="submit" id="field{{record.commissioned_user.account_mail}}{{ case.case_id }}_star1" name="{{record.commissionrecord_id}}" value="1" /><label class = "full" for="field{{record.commissioned_user.account_mail}}{{ case.case_id }}_star1"></label>
                                                                                            </fieldset>
                                                                                        </form>
                                                                                    {% endif %}
                                                                                </td>
                                                                                <td style="line-height: 50px;text-align: center;">
                                                                                    <button class="btn btn-primary" type="button" disabled="disabled" style="width: 120px;height: 24px;font-size: 12px;line-height: 10px;background: #ca6c38;border-style: none;">已完成委託</button>
                                                                                </td>
                                                                            {% elif record.user_status.status_id == 4 %}
                                                                                <td class="d-block" style="width: 150px;text-align: center;color: rgb(170, 109, 38);"><br>&nbsp;</td>
                                                                                <td style="line-height: 50px;text-align: center;">
                                                                                    <button class="btn btn-primary" disable="disable" type="button" disabled="disabled" style="width: 120px;height: 24px;font-size: 12px;line-height: 10px;border-color: #7b3b20;background: rgba(13,110,253,0);color: #7b3b20;">已解除</button>
                                                                                </td>
                                                                            {% elif record.user_status.status_id == 5 %}
                                                                                <td class="d-block" style="width: 150px;text-align:center; color: rgb(38, 86, 56);" ><br>已發起解除請求<br>等待對方回覆！</td>
                                                                                <td style="line-height: 30px;text-align: center;">
                                                                                    <button class="btn btn-primary" type="button" disabled="disabled" style="width: 120px;height: 24px;font-size: 12px;line-height: 10px;background: #ca6c38;border-style: none;">完成</button>
                                                                                    <button class="btn btn-primary" type="button" disabled="disabled" style="width: 120px;height: 24px;margin-top: 6px;font-size: 12px;line-height: 10px;border-color: #7b3b20;background: rgba(13,110,253,0);color: #7b3b20;">解除中...</button>
                                                                                </td>
                                                                            {% elif record.user_status.status_id == 6 %}
                                                                                <td  class="d-block" style="width: 150px;text-align: center;color: rgb(200, 4, 4);"><br>對方已發出取消請求<br>請即時確認！</td>
                                                                                <td style="line-height: 30px;text-align: center;">
                                                                                    <button class="btn btn-primary" type="button" disabled="disabled" style="width: 120px;height: 24px;font-size: 12px;line-height: 10px;background: #ca6c38;border-style: none;">完成</button>
                                                                                    <button class="btn btn-primary" type="button" onclick="window.location='/toolfamily/user/delete/{{record.commissionrecord_id}}'" style="width: 120px;height: 24px;font-size: 12px;line-height: 10px;background: #ca6c38;border-style: none;">確認解除</button>
                                                                                </td>
                                                                            {% elif record.user_status.status_id == 7 %}
                                                                                <td  class="d-block" style="width: 150px;text-align: center;color: rgb(38, 86, 56);" ><br>對方已發起完成請求<br>請即時確認！</td>
                                                                                <td style="line-height: 30px;text-align: center;">
                                                                                    <button class="btn btn-primary" type="button" onclick="window.location='/toolfamily/user/finish/{{record.commissionrecord_id}}'"style="width: 120px;height: 24px;font-size: 12px;line-height: 10px;background: #ca6c38;border-style: none;">完成</button>
                                                                                    <button class="btn btn-primary" type="button" onclick="window.location='/toolfamily/user/delete/{{record.commissionrecord_id}}'" style="width: 120px;height: 24px;margin-top: 6px;font-size: 12px;line-height: 10px;border-color: #7b3b20;background: rgba(13,110,253,0);color: #7b3b20;">解除</button>
                                                                                </td>
                                                                            {% endif %}
                                                                        </tr>
                                                                        {% endif %}
                                                                    {% endfor %}
                                                                </tbody>
                                                                
                                                            </table>
                                                        </div>
                                                    </div>
                                                </td>
                                            </tr> 
                                    </tbody>
                                    {% endif %}
                                {% endfor %}
                                </table>
                            <!-- </div> -->
                        </div>
                    </div>

<!-- history -->
                    <div id="publish_his" style="display: none;">
                        <div class="d-none d-xl-block table-responsive" style="margin-top: 5px;">
                            <table class="table table-borderless">
                                <tbody>
                                    <tr>
                                        <td style="width: 100px;"></td>
                                        <td style="width: 120px;">↓ 發布時間</td>
                                        <td class="d-block"style="width: 240px;">標題</td>
                                        <td style="width: 150px;">結束時間</td>
                                        <td class="d-block" style="width: 150px;">獲得的評價</td>
                                        <td style="width: 150px;">狀態</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="table-responsive" style="margin-top: -19px; margin-left: 40px;margin-right: 40px;margin-bottom: 50px; background: #e2dad4;border-radius: 27px;border: 1px solid rgb(125,105,105);">
                            <table class="table table-borderless" style="margin-top: 7px;">
                                {% for case in case_list %}
                                {% if case.case_status.status_name in '完成,關閉' %}
                                <tbody>  
                                    <tr>
                                        {% load static %}
                                        <td style="width: 80px;padding-right: 0px;padding-left: 20px;padding-bottom: 0px;">
                                            <button class="btn btn-primary" onclick="changeImage('{{ case.case_id }}')" type="button" data-bs-toggle="collapse" data-bs-target="#M{{ case.case_id }}" aria-expanded="false" aria-controls="M{{ case.case_id }}"  style="background: rgba(13,110,253,0);color: rgb(38, 29, 29);border-style: none;">
                                                <img id="{{ case.case_id }}" src="{% static 'images/Vector2.png' %}">
                                            </button>
                                        </td>
                                        <td style="line-height: 35px;color: rgb(121, 110, 110);width: 120px;padding-bottom: 0px;" id="creatdateh{{ case.case_id }}">
                                            {{case.created_datetime}}
                                            <script> 
                                                var oriTime = "{{case.created_datetime}}"
                                                var ouputId = "creatdateh{{ case.case_id }}"
                                                changeTime(oriTime, ouputId, "s");
                                            </script>
                                        </td>
                                        <td class="d-block" style="width: 250px;"><a class="case_title" href="{% url 'case-profile' case.case_id %}" style="line-height: 35px;padding-bottom: 0px;">{{case.title}}</a></td>
                                        
                                    
                                        <td style="width: 180px;line-height: 35px;color: rgb(121, 110, 110); padding-bottom: 0px;" id="enddateh{{ case.case_id }}">
                                            {{case.ended_datetime}}
                                            <script> 
                                                var oriTime = "{{case.ended_datetime}}"
                                                var ouputId = "enddateh{{ case.case_id }}"
                                                changeTime(oriTime, ouputId ,"s");
                                            </script>
                                        </td>
                                        <td  class="d-block" style="line-height: 35px; width: 150px;text-align: center;">
                                            {% for key2, val2 in avg_rate.items %}
                                                {% if key2 == case.case_id %}  
                                                <span id="starph{{ case.case_id }}">
                                                    {{val2}}
                                                    <script>
                                                        var starId = "starph{{ case.case_id }}"
                                                        var value = "{{val2}}"
                                                        getStar(starId, value );
                                                    </script>
                                                </span>
                                                {% endif %}
                                            {% endfor %}
                                        </td>

                                        <td style="width: 180px; text-align: center;padding-top: 10px;">
                                            <button class="btn btn-primary" type="button" disabled="disabled" style="width: 100px;height: 24px;font-size: 12px;line-height: 10px;border-color: #7b3b20;background: rgba(13,110,253,0);color: #7b3b20;">{{case.case_status.status_name}}</button>
                                        </td>

                                        <!-- <td  style="width: 200px;line-height: 35px;color: rgb(61,46,47);padding-bottom: 0px;"></td> -->
                                            
                                    </tr>
                                        <tr>
                                            <td colspan="9" style="padding-left: 0px;padding-right: 0px;padding-top: 0px;padding-bottom: 0px; ">
                                                <div class="collapse" id="M{{ case.case_id }}">
                                                    <div class="table-responsive">
                                                        <table class="table table-borderless">
                                                            <tbody>
                                                                <tr>
                                                                    <td colspan="9" style="background: #f4f4f3;color: rgb(134,81,64);">&nbsp; &nbsp; &nbsp;已選名單</td>
                                                                </tr>
                                                                {% for record,canReport in record_list %}
                                                                    {% if record.case == case %}
                                                                    
                                                                    <tr style="font-size: 12px;background: #ffffff;">
                                                                        <td style="width: 80px; padding-top: 20px; padding-left: 30px;">
                                                                            {% if record.commissioned_user.icon %}
                                                                                    <div class="img-circular" style="background-image: url({{record.commissioned_user.icon.url}});"></div>
                                                                                    <!-- <img class="img-circular" src="{{record.commissioned_user.icon.url}}" style="width: 43px; background-color: #ca6c38;"> -->
                                                                                {% else %}
                                                                                    {% load static %}
                                                                                    <div class="img-circular"></div>
                                                                                    <!-- <img  class="img-circular" src="{% static 'images/default_icon_1.png' %}" style="width: 43px;background-color: #ca6c38;"> -->
                                                                                {% endif %}
                                                                        </td>
                                                                        <td class="d-block" style="line-height: 18px;width: 180px;">
                                                                            {% comment %} {% url 'others-user-profile' record.commissioned_user.user_id %} {% endcomment %}
                                                                            <a class="link_title" href="{% url 'others-user-profile' record.commissioned_user.user_id %}" style="line-height: 41px;">
                                                                                {% if record.commissioned_user.nickname != "" %}
                                                                                    {{record.commissioned_user.nickname}}
                                                                                {% else %}
                                                                                    {{record.commissioned_user.name}}
                                                                                {% endif %}

                                                                                {% load static %} 
                                                                                {% if record.commissioned_user.gender == 0 %}
                                                                                    {% load static %}
                                                                                    <img  style="width: 18px;"src="{% static 'images/gender-female.png' %}" style="margin-left: 10px;">
                                                                                {% elif record.commissioned_user.gender == 1 %}
                                                                                    {% load static %}
                                                                                    <img style="width: 18px;"src="{% static 'images/gender-male.png' %}" style="margin-left: 10px;">
                                                                                {% else %}
                                                                                    {% load static %}
                                                                                    <img style="width: 18px;"src="{% static 'images/gender-male-female.png' %}" style="margin-left: 10px;">
                                                                                {% endif %}
                                                                            </a>
                                                                            <div class="w-100">
                                                                                <span style="color: rgb(142,145,147);font-size: 12px;line-height: 0px;" id="ph{{record.commissioned_user.account_mail}}{{ case.case_id }}">上次登入: {{record.commissioned_user.django_user.last_login}}
                                                                                    <script> 
                                                                                        var oriTime = "{{record.commissioned_user.django_user.last_login}}"
                                                                                        var ouputId = "ph{{record.commissioned_user.account_mail}}{{ case.case_id }}"
                                                                                        changeTime(oriTime, ouputId ,"user");
                                                                                    </script>
                                                                                </span>
                                                                            </div>
                                                                        </td>
                                                                        <!-- 追蹤、檢舉 -->
                                                                        <td style="width: 100px;line-height: 56px;">
                                                                            {% if canReport %}
                                                                                <button class="btn btn-primary" id="button-user-report" type="button" data-bs-toggle="modal" data-bs-target="#reportModal" data-user="{{ record.commissioned_user.user_id }}" data-case="{{ case.case_id }}" style="background: rgba(13,110,253,0);color: rgb(38, 29, 29);border-style: none;width: 30px;padding: 0px 12px;padding-right: 0px;padding-left: 0px;height: 30px;"><img src="{% static 'images/Report%20problem.png' %}" style="padding-top: 0px;" data-userID="{{record.commissioned_user.user_id}}"></button>
                                                                            {% else %}
                                                                                <button class="btn btn-primary" id="button-user-report" type="button" data-bs-toggle="modal" style="background: rgba(13,110,253,0);color: rgb(38, 29, 29);border-style: none;width: 30px;padding: 0px 12px;padding-right: 0px;padding-left: 0px;height: 30px;"><img src="{% static 'images/Report%20problem.png' %}" style="padding-top: 0px;" data-userID="{{record.commissioned_user.user_id}}"></button>
                                                                            {% endif %}
                                                                        </td>
                                                                        <td id ="contacth{{record.commissioned_user.account_mail}}{{ case.case_id }}" style="line-height: 58px;width:350px;color: rgb(85,58,58);">
                                                                            {% if contact != None %}
                                                                                {{record.commissioned_user.contact}}
                                                                            {% else %}
                                                                                {{record.commissioned_user.account_mail}}
                                                                            {% endif %}
                                                                            {% load static %}
                                                                            <button onclick="copy('contacth{{record.commissioned_user.account_mail}}{{ case.case_id }}')" class="btn btn-primary d-none d-lg-block" type="button" style="background: rgba(13,110,253,0);color: rgb(38, 29, 29);border-style: none;width: 30px;height: 30px;margin-top: -50px;margin-left: 130px;"><img src="{% static 'images/Content%20copy.png' %}"></button>
                                                                            <!-- <button onclick="copy('contacth{{record.commissioned_user.account_mail}}{{ case.case_id }}')" class="btn btn-primary" type="button" style="background: rgba(13,110,253,0);color: rgb(38, 29, 29);border-style: none;width: 30px;height: 30px;padding: 0px 0px;margin-top: -4px;"><img src="{% static 'images/Content%20copy.png' %}"></button> -->
                                                                        </td>
                                                                        {% if record.user_status.status_id == 3 %}
                                                                            <td class="d-block" style="line-height: 56px;padding-left: 40px; width: 180px;color: rgb(85,58,58);">
                                                                                {% if record.rate_publisher_to_worker %}
                                                                                    <span id="starh{{record.commissioned_user.account_mail}}{{ case.case_id }}">
                                                                                        <script>
                                                                                            var starId = "starh{{record.commissioned_user.account_mail}}{{ case.case_id }}"
                                                                                            var value = "{{record.rate_publisher_to_worker}}"
                                                                                            getStar(starId, value );</script>
                                                                                    </span>&nbsp; 評價
                                                                                {% else %}
                                                                                <form action="/toolfamily/user/rate/" method="post" style="margin-left: 10px;"onSubmit="return confirm('確定送出評價？');">
                                                                                    <label>&nbsp; 評價</label>
                                                                                    {% csrf_token %}
                                                                                    <fieldset class="rating">
                                                                                        <input type="submit" id="field{{record.commissioned_user.account_mail}}{{ case.case_id }}_star5" name="{{record.commissionrecord_id}}" value="5" /><label class = "full" for="field{{record.commissioned_user.account_mail}}{{ case.case_id }}_star5"></label>
                                                                                        <input type="submit" id="field{{record.commissioned_user.account_mail}}{{ case.case_id }}_star4" name="{{record.commissionrecord_id}}" value="4" /><label class = "full" for="field{{record.commissioned_user.account_mail}}{{ case.case_id }}_star4"></label>
                                                                                        <input type="submit" id="field{{record.commissioned_user.account_mail}}{{ case.case_id }}_star3" name="{{record.commissionrecord_id}}" value="3" /><label class = "full" for="field{{record.commissioned_user.account_mail}}{{ case.case_id }}_star3"></label>
                                                                                        <input type="submit" id="field{{record.commissioned_user.account_mail}}{{ case.case_id }}_star2" name="{{record.commissionrecord_id}}" value="3" /><label class = "full" for="field{{record.commissioned_user.account_mail}}{{ case.case_id }}_star2"></label>
                                                                                        <input type="submit" id="field{{record.commissioned_user.account_mail}}{{ case.case_id }}_star1" name="{{record.commissionrecord_id}}" value="1" /><label class = "full" for="field{{record.commissioned_user.account_mail}}{{ case.case_id }}_star1"></label>
                                                                                    </fieldset>
                                                                                </form>
                                                                                {% endif %}
                                                                            </td>
                                                                            <td style="width: 190px; text-align: center;line-height: 56px;">
                                                                                <button class="btn btn-primary" type="button" disabled="disabled" style="width: 100px;height: 24px;font-size: 12px;line-height: 10px;border-color: #7b3b20;background: rgba(13,110,253,0);color: #7b3b20;">已完成委託</button>
                                                                            </td>
                                                                        {% elif record.user_status.status_id == 4 %}
                                                                            <td class="d-block" id="deleh{{record.commissioned_user.account_mail}}{{ case.case_id }}" style="text-align: center;width: 180px;color: rgb(85,58,58);" >
                                                                                於 {{record.doublecheck_datetime}}<br>解除委託
                                                                                <script>
                                                                                    var oriTime = "{{record.doublecheck_datetime}}"
                                                                                    var ouputId = "deleh{{record.commissioned_user.account_mail}}{{ case.case_id }}"
                                                                                    changeTime(oriTime, ouputId, "dele");
                                                                                </script> 
                                                                            </td>
                                                                            <td style="width: 190px; text-align: center;line-height: 56px;">
                                                                                <button class="btn btn-primary" type="button" disabled="disabled" style="width: 100px;height: 24px;font-size: 12px;line-height: 10px;border-color: #7b3b20;background: rgba(13,110,253,0);color: #7b3b20;">已解除委託</button>
                                                                            </td>
                                                                        {% else %}
                                                                            <td class="d-block" style="width: 180px;text-align: center; color: rgb(93, 170, 38);">時間結束<br>自動完成委託</td>
                                                                            <td style="width: 190px; text-align: center;line-height: 56px;">
                                                                                <button class="btn btn-primary" type="button" disabled="disabled" style="width: 100px;height: 24px;font-size: 12px;line-height: 10px;border-color: #7b3b20;background: rgba(13,110,253,0);color: #7b3b20;">自動完成委託</button>
                                                                            </td>
                                                                        {% endif %}
                                                                        </tr>
                                                                    {% endif %}
                                                                   
                                                                {% endfor %}
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr> 
                                </tbody>
                                {% endif %}
                            {% endfor %}
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% if messages %}
    {% for message in messages %}
        {% if 'origin_case' in message.extra_tags %}
           <!-- <p style="color: #ca6c38;"> {{ message }} </p> -->
           
           <script>
            if( '{{ message }}' != ''){
                $("#B{{ message }}").attr('aria-expanded','true');
                changeImage('{{ message }}'); 
                $("#M{{ message }}").removeClass('collapse').addClass('collapse show');
            }
            </script>
        {% elif 'origin_page' in message.extra_tags %}
            <script>
            if( '{{ message }}' != ''){
                changePage('{{ message }}');
            }
            </script>
        {% endif %}
    {% endfor %}
    {% endif %}
    {% load static %}
</body>
{% endblock %}
</html>>

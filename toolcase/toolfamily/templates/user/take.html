{% extends "base_generic.html" %}
<!DOCTYPE html>
<html lang="en">
{% load static %}

<script src="/static/bootstrap/js/bootstrap.min.js"></script>

{% block content %}
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>台大工具箱</title>
    <script src="\static\js\report.js" type="text/javascript"></script>
    <link rel="stylesheet" href="/static/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="/static/fonts/material-icons.min.css">
    <link rel="stylesheet" href="/static/css/take-styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<link rel="stylesheet" href="\static\css\user.css">
<style>
    /* image */
    .img-circular{
        width: 43px;
        height: 43px;
        background-image: url('/static/images/default_icon_1.png');
        background-size: cover;
        display: block;
        border-radius: 100px;
        -webkit-border-radius: 100px;
        -moz-border-radius: 100px;
    }
    /* address style */
    a.link_title:link {
        color:rgba(134, 81, 64);
        text-decoration: none;
    }
    a.link_title:visited{
        color:rgba(134, 81, 64);
    }
    a.link_title:hover{
    color:rgb(204,195,190);
    }

    a.case_title:link{
        color: rgb(60,46,47);
        text-decoration: none;
    }
    a.case_title:visited{
        color: rgb(60,46,47);
    }

    a.case_title:hover{
        color: rgba(134, 81, 64);
    }
    /* star */
    .checked {
    color: #f3d16d;
    }
    .unchecked {
    color: #f6b902;
    }
    .helfchecked {
    color: #f3d16d;
    }
    fieldset, label { margin: 0; padding: 0; }
    
    h1 { font-size: 1.5em; margin: 10px; }
    
    /****** Style Star Rating Widget *****/
    
    .rating { 
      border: none;
      float: left;
    }
    
    .rating > input { display: none; } 
    .rating > label:before { 
      margin: 0px;
      font-size: 1.25em;
      font-family: FontAwesome;
      display: inline-block;
      content: "\f005";
    }
    
    .rating > .half:before { 
      content: "\f089";
      position: absolute;
    }
    
    .rating > label { 
      color: #ddd; 
     float: right; 
    }
    
    /***** CSS Magic to Highlight Stars on Hover *****/
    
    .rating > input:checked ~ label, /* show gold star when clicked */
    .rating:not(:checked) > label:hover, /* hover current star */
    .rating:not(:checked) > label:hover ~ label { color: #f3d16d;  } /* hover previous stars in list */
    
    .rating > input:checked + label:hover, /* hover current star when changing rating */
    .rating > input:checked ~ label:hover,
    .rating > label:hover ~ input:checked ~ label, /* lighten current selection */
    .rating > input:checked ~ label:hover ~ label { color: #f3d16d;  } 
    
    @media screen and (min-width: 991px){
        .screenM{
            margin-right: 15px;
            margin-left: 15px;
        }
    }
    
    </style>
{% load static %}
<script src="\static\js\user.js" type="text/javascript"></script>
<script >
    function changeImage(id) {
        var a = id
        var url = window.location.origin + "{% static 'images/Vector2.png' %}"

        if (document.getElementById(id).src == url){
            document.getElementById(id).src = "{% static 'images/Vector.png' %}";
        } else{
            document.getElementById(id).src = "{% static 'images/Vector2.png' %}";
        }
    }
    function changeTime(oriTime, ouputId, status){
        var yyyy = oriTime.split('年')[0]
        var mm = oriTime.split('年')[1].split('月')[0]
        var dd = oriTime.split('年')[1].split('月')[1].split('日')[0]
        var tt = oriTime.split('年')[1].split('月')[1].split('日 ')[1]
        if (mm.length == 1){
            mm = "0"+mm;
        }
        if (dd.length ==1){
            dd = "0"+dd
        }
        var today = yyyy + '/' + mm + '/' + dd
        var enddate = new Date(mm + '/' + dd + '/' + yyyy + ' '+ tt)
        var currentdate = new Date();
        var remainday = Math.abs((enddate.getTime() - currentdate.getTime()))

        if (status == "s"){
            document.getElementById(ouputId).innerHTML=today;
        }else if (status =="e"){
            document.getElementById(ouputId).innerHTML=today + "<span class='d-inline-block text-truncate' style='max-width: 100px;'><span style='margin-left: 5px;color: rgb(60,46,47); font-size: 14px;'> 還剩 </span> <span style='font-size:18px;color: rgb(193, 106, 110)'>"+ msToTime(remainday)+" </span></span>";
        }else if (status =="user"){
            document.getElementById(ouputId).innerHTML="上次登入: "+ msToTime(remainday)+"前";
        }else if (status =="r"){
            document.getElementById(ouputId).innerHTML="<span class='d-inline-block text-truncate' style='max-width: 100px;'><span style='color: rgb(60,46,47); font-size: 14px;'> 還剩 </span> <span style='font-size:18px;color: rgb(193, 106, 110)'>"+ msToTime(remainday)+" </span></span>";
        }else{
            document.getElementById(ouputId).innerHTML="於 "+ today+ " <br>解除案件";
        }
    }
    function msToTime(ms) {
        let seconds = (ms / 1000).toFixed(0);
        let minutes = (ms / (1000 * 60)).toFixed(0);
        let hours = (ms / (1000 * 60 * 60)).toFixed(0);
        let days = (ms / (1000 * 60 * 60 * 24)).toFixed(0);
        if (seconds < 60) return seconds + " 秒";
        else if (minutes < 60) return minutes + " 分鐘";
        else if (hours < 24) return hours + " 小時";
        else return days + " 天"
    }
    function changePage(Page){
        if (Page == "take_his"){
            document.getElementById("take_his").style.display="";
            document.getElementById("take_sign").style.display="none";
            document.getElementById("taking").style.display="none";

            document.getElementById("historyA").style.color="rgb(94, 73, 73)";
            document.getElementById("registrationA").style.color="rgb(204,195,190)";
            document.getElementById("takeA").style.color="rgb(204,195,190)";
           
        }else if(Page == "take_sign"){
            document.getElementById("take_his").style.display="none";
            document.getElementById("take_sign").style.display="";
            document.getElementById("taking").style.display="none";

            document.getElementById("historyA").style.color="rgb(204,195,190)";
            document.getElementById("registrationA").style.color="rgb(94, 73, 73)";
            document.getElementById("takeA").style.color="rgb(204,195,190)";
            
        }else if(Page == "taking"){
            document.getElementById("take_his").style.display="none";
            document.getElementById("take_sign").style.display="none";
            document.getElementById("taking").style.display="";

            document.getElementById("historyA").style.color="rgb(204,195,190)";
            document.getElementById("registrationA").style.color="rgb(204,195,190)";
            document.getElementById("takeA").style.color="rgb(94, 73, 73)";
        }
        
    }

    function getStar(starId,value){
        if (value =="None"){
            value = 0;
        } 
        var stringA = "<span class='fa fa-star checked'></span>"
        var stringB = "<span class='fa fa-star-o unchecked'></span>"
        var stringC = "<span class='fa fa-star-half-o helfchecked'></span>"
        var result = ""
        valueInt = parseInt(value)
        for (i = 0; i < valueInt; i++){
            result= result+stringA
        }
        if ((value-valueInt)!=0){
            result= result+stringC
        }
        var los = 5-Math.ceil(value)
        for(j = 0; j<los; j++){
            result = result+stringB
        }

        document.getElementById(starId).innerHTML=result
    }
    // copy

    function copy(id){
        var r = document.createRange();
        r.selectNode(document.getElementById(id));
        window.getSelection().removeAllRanges();
        window.getSelection().addRange(r);
        document.execCommand('copy');
        window.getSelection().removeAllRanges();
    }
    
    
</script>
<body style="background: rgb(244,244,243);">
    <!-- report modal -->
    <div class="modal fade" id="reportModal" tabindex="10" aria-labelledby="reportModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="reportModalLabel">檢舉工具人</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <form action="{% url 'create-report' %}" method="POST">
                {% csrf_token %}
                {# 用不可變的input發送檢舉目標 [!]需要用js在modal彈出時填入 #}
                <div class="mb-3">
                    <label for="reported-case" class="col-form-label">被檢舉的案件</label>
                    <input type="text" id="text-case" class="form-control" readonly>
                    <input type="text" id="report_case" name="reported_case" style="display:none">
                </div>
                <div class="mb-3">
                    <label for="reported_obj" class="col-form-label">被檢舉人</label>
                    <input type="text" id="text-user" class="form-control" readonly>
                    <input type="text" id="report_user" name="reported_user" style="display:none">
                </div>
                <div class="mb-3">
                  <label for="report-type" class="col-form-label">檢舉類型:</label>
                  {# <input type="text" class="form-control" id="report-type"> #}
                  {# 用選單選擇檢舉類型 #}
                  <select class="form-control" id="report-type" name="report_type">
                  {% for type in reportTypes %}
                    <option value="{{ type.report_type_id }}">
                        {{ type.report_type_name }}
                    </option>
                  {% endfor %}
                  </select>
                </div>
                <div class="mb-3">
                  <label for="report-message" class="col-form-label">檢舉內容:</label>
                  <textarea class="form-control" id="report-message" name="description"></textarea>
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
              <button type="button" class="btn btn-primary">送出</button>
            </div>
          </div>
        </div>
    </div>
    <!-- --------Image Board-------- -->
    <div class="container" style="margin-top: 50PX;height: 100px;width: 100%;margin-right: 0px;margin-left: 0px;padding-right: 0px;padding-left: 0px;max-width: none;">
        <div class="row" style="height: 100px;width: 100%;margin: 0px;">
            <div class="col" style="height: 100px;width: 100%;padding: 0px;"><img src="\static\images\ntu_1.png" style="width: 100%;height: 100px;"></div>
        </div>
    </div>
    <div class="container-fuild" >
        <div class="screenM row">
            <!-- style="margin-right: 15px;margin-left: 15px;" -->
            <div class="d-none d-lg-block col-sm-2">
                <div class="justify-content-center " style="margin-top: 30px;">
                    <ul class="list-group borderless rounded" style="font-size: 18px;line-height: 30px; text-align: center;display:block; box-shadow: 2px 2px rgba(196, 190, 190, 0.81);">
                        <li class="list-group-item member " m="1" style="height: 50px;"><a class="link_title" href="{%url 'my-user-profile'%}" >會員中心</a></li>
                        <li class="list-group-item" style="height: 50px;"><a class="link_title" href="{%url 'user-publish-record'%}" >我的委託</a></li>
                        <li class="list-group-item bold " style="height: 50px; "><a class="link_title" href="{%url 'user-take-record'%}">我的接案</a></li>
                        <li class="list-group-item" style="height: 50px;"><a class="link_title" href="{% url 'user-password-update' %}" >更改密碼</a></li>
                        <li class="list-group-item" style="height: 50px;"><a class="link_title" href="{% url 'logout' %}">登出</a></li>
                    </ul>
                </div>
            </div>
            <div class="col-md-10" style="margin-top: 30px; ">
                {% load static %}
                <div class="border rounded" style="background: #ffffff; box-shadow: 2px 3px rgba(196, 190, 190, 0.81);">
                    <h1 class="fw-bold text-center" style="height: 80px; margin-top: 40px; padding-top: 20px; background-repeat: no-repeat; background-position: 46%, center; background-image: url('{% static 'images/Ellipse%204.png' %}');  color: rgb(94, 73, 73);font-size: 30px;">我的接案</h1>
                    <div class="position-relative underlineEffects" style="margin-top: -45px;">
                        <ul style="margin-left: 40px;margin-bottom: 20px;">
                            <li><a id="takeA"href="javascript:void(0);" style="color: rgb(94, 73, 73);"onclick="changePage('taking');">我的接案</a></li>
                            <li><a id="registrationA" href="javascript:void(0);" onclick="changePage('take_sign');">報名案件</a></li>
                            <li><a id="historyA" href="javascript:void(0);" onclick="changePage('take_his');">歷史紀錄</a></li>
                        </ul>
                        <!-- <div class="d-none d-xl-block position-absolute top-0 end-0" style="width: 300px; margin-top: 30px;">
                            <span style="margin-left: 28px;color: rgb(94, 73, 73);font-size: 14px;">篩選</span>
                            <div class="dropdown" style="width: 166px;margin-left: 72px;margin-top: -24px;"><button class="btn btn-primary dropdown-toggle" aria-expanded="false" data-bs-toggle="dropdown" type="button" style="height: 24px;background: rgb(232,231,229);font-size: 16px;text-align: right;line-height: 8.5px;border-style: none;width: 160.125px;"></button>
                                <div class="dropdown-menu" style="font-size: 12px;text-align: justify;"><a class="dropdown-item" href="#" style="color: rgb(94,73,73);">按發布時間</a><a class="dropdown-item" href="#" style="color: rgb(94,73,73);">按結束時間</a><a class="dropdown-item" href="#" style="color: rgb(94,73,73);">按狀態</a></div>
                            </div>
                        </div> -->
                    </div>
                    
<!-- take -->
                    <div id="taking">
                        <div class="d-none d-xl-block table-responsive" style="margin-left: 40px;margin-right: 40px;margin-top: 5px;">
                            <table class="table table-borderless">
                                <tbody>
                                    <tr>
                                        <td style="width: 80px;"></td>
                                        <!-- <button class="btn btn-primary" type="button" style="background: rgba(13,110,253,0);color: rgb(142,93,78);border-style: none;width: 30px;padding: 0px 0px;padding-right: 0px;padding-left: 0px;height: 30px;">↓</button> -->
                                        <td style="width: 150px;">結束時間</td>
                                        <td style="width: 350px;">案件名稱</td>
                                        <td style="text-align: center;width: 150px;">報酬</td>
                                        <td style="text-align: center;width: 185px;">訊息</td>
                                        {% load static %}
                                        <td style="text-align: center; width: 180px;">狀態</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="table-responsive"style="margin-top: -19px;margin-left: 40px;margin-right: 40px;margin-bottom: 50px; background: rgba(244, 244, 243, 1);border-radius: 27px;border: 1px solid rgb(125,105,105);">
                            <table style="margin-top: 7px;" class="table table-borderless">
                                {% for commission,canReport in conduct %}
                                <tbody>
                                    <trs>
                                        {% load static %}
                                        <td style="width: 80px;padding-right: 0px;padding-left: 20px;padding-bottom: 0px;">
                                            <button class="btn btn-primary" onclick="changeImage({{ commission.case.case_id }})" type="button" data-bs-toggle="collapse" data-bs-target="#M{{ commission.case.case_id }}" aria-expanded="false" aria-controls="M{{ commission.case.case_id }}"  style="line-height: 45px; background: rgba(13,110,253,0);color: rgb(38, 29, 29);border-style: none;">
                                                <img id="{{ commission.case.case_id }}" src="{% static 'images/Vector2.png' %}">
                                            </button>
                                        </td>
                                        <td style="line-height: 50px;color: rgb(121, 110, 110);width: 150px;padding-bottom: 0px;" id="enddate{{ commission.case.case_id }}">
                                            {{commission.case.ended_datetime}}
                                            <script> 
                                                var oriTime = "{{commission.case.ended_datetime}}"
                                                var ouputId = "enddate{{ commission.case.case_id }}"
                                                changeTime(oriTime, ouputId ,"s");
                                            </script>
                                        </td>
                                        <td style="width: 350px;">
                                            <a class="case_title" href="{% url 'case-profile' commission.case.case_id %}" style="line-height: 50px;padding-bottom: 0px;">
                                                <span class="d-inline-block text-truncate" style="max-width: 250px;">{{commission.case.title}}</span>
                                            </a>
                                        
                                        </td>
                                        <td style="text-align: center; width: 150px;line-height: 50px;color: rgb(121, 110, 110); padding-bottom: 0px;">
                                            <span class="d-inline-block text-truncate" style="max-width: 100px;">{{commission.case.reward}}</span>
                                        </td>
                                        {% if commission.user_status.status_id == 2 %}
                                            {% for key, value in deadline.items %}
                                                {% if commission.commissionrecord_id == key %}
                                                <td id="rT{{ commission.case.case_id }}" style="width: 185px;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;text-align: center;line-height: 50px;">還剩 {{commission.case.ended_datetime}}
                                                <script>
                                                    var oriTime = "{{commission.case.ended_datetime}}"
                                                    var ouputId = "rT{{ commission.case.case_id }}"
                                                    changeTime(oriTime, ouputId ,"r");
                                                </script>
                                                {% endif %}
                                            {% endfor %}
                                            </td>
                                            <td style="width: 180px; text-align: center;">
                                                <button class="btn btn-primary" type="button" onclick="sendCompuser()" value="完成" style="width: 110px;height: 24px;font-size: 12px;line-height: 10px;background: #ca6c38;border-style: none;">完成</button><br>
                                                <button class="btn btn-primary" type="button" onclick="sendDeleuser()"  value="解除" style="width: 110px;height: 24px;margin-top: 6px;font-size: 12px;line-height: 10px;border-color: #7b3b20;background: rgba(13,110,253,0);color: #7b3b20;">解除</button>
                                                <script>
                                                    function sendDeleuser(){
                                                        if(confirm('確定解除工作？') == true){
                                                            window.location='/toolfamily/user/delete/{{commission.commissionrecord_id}}'
                                                        }
                                                    }
                                                    function sendCompuser(){
                                                        if(confirm('確定完成工作？') == true){
                                                            window.location='/toolfamily/user/finish/{{commission.commissionrecord_id}}'
                                                        }
                                                    }   
                                                </script>
                                                
                                            </td>
                                        {% elif commission.user_status.status_id == 5 %}
                                            <td style="text-align: center;width: 185px;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;line-height: 50px;font-size: 15px;">對方發出取消請求</td>
                                            <td style="width: 180px; text-align: center;">
                                                <button class="btn btn-primary" type="button" disabled value="完成" style="width: 110px;height: 24px;font-size: 12px;line-height: 10px;background: #ca6c38;border-style: none;">完成</button><br>
                                                <button class="btn btn-primary" type="button" onclick="window.location='/toolfamily/user/delete/{{commission.commissionrecord_id}}'"  value="確認取消" style="width: 110px;height: 24px;margin-top: 6px;font-size: 12px;line-height: 10px;border-color: #7b3b20;background: rgba(13,110,253,0);color: #7b3b20;">確認取消</button>
                                                
                                            </td>
                                        {% elif commission.user_status.status_id == 6 %}
                                            <td style="text-align: center;width: 185px;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;line-height: 50px;font-size: 15px;">等待對方確認取消</td>
                                            <td style="width: 180px; text-align: center;">
                                                <button class="btn btn-primary" type="button" disabled value="完成" style="width: 110px;height: 24px;font-size: 12px;line-height: 10px;background: #ca6c38;border-style: none;">完成</button><br>
                                                <button class="btn btn-primary" type="button" disabled  value="解除" style="width: 110px;height: 24px;margin-top: 6px;font-size: 12px;line-height: 10px;border-color: #7b3b20;background: rgba(13,110,253,0);color: #7b3b20;">解除中...</button>
                                            </td>
                                        {% elif commission.user_status.status_id == 7 %}
                                            <td style="text-align: center;width: 185px;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;line-height: 50px;font-size: 15px;">等待對方確認完成</td>
                                            <td style="width: 180px; text-align: center;">
                                                <button class="btn btn-primary" type="button" disabled value="完成" style="width: 110px;height: 24px;font-size: 12px;line-height: 10px;background: #ca6c38;border-style: none;">完成中...</button><br>
                                                <button class="btn btn-primary" type="button" disabled  value="解除" style="width: 110px;height: 24px;margin-top: 6px;font-size: 12px;line-height: 10px;border-color: #7b3b20;background: rgba(13,110,253,0);color: #7b3b20;">解除</button>
                                            </td>
                                        {% endif %}
                                    </tr>
                                        <tr>
                                            <td colspan="9" style="padding-left: 0px;padding-right: 0px;padding-top: 0px;padding-bottom: 0px; ">
                                                <div class="collapse" id="M{{ commission.case.case_id }}">
                                                    <div class="table-responsive">
                                                        <table class="table tableContain table-borderless">
                                                            <tbody>
                                                                <tr style="font-size: 12px;background: #ffffff;">
                                                                    <td style="line-height: 60px; width: 250px;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;text-align: center;">｜委託人資訊</td>
                                                                    
                                                                    <td style="padding-top:20px; line-height: 30px; width: 250px;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;">
                                                                        {% if commission.case.publisher.icon %}
                                                                            <div class="img-circular" style="background-image: url({{commission.case.publisher.icon.url}});"></div>
                                                                        {% else %}
                                                                            {% load static %}
                                                                            <div class="img-circular"></div>
                                                                        {% endif %}
                                                                        
                                                                        <div style="margin-top: -50px; margin-left: 55px;">
                                                                            {% comment %} {% url 'others-user-profile' commission.case.publisher.user_id %} {% endcomment %}
                                                                            <a class="link_title" href="{% url 'others-user-profile' commission.case.publisher.user_id %}" style="">
                                                                                {% if commission.case.publisher.nickname != "" %}
                                                                                    {{commission.case.publisher.nickname}}
                                                                                {% else %}
                                                                                    {{commission.case.publisher.name}}
                                                                                {% endif %}
                                                                                
                                                                                
                                                                                {% load static %} 
                                                                                {% if commission.case.publisher.gender == 0 %}
                                                                                    {% load static %}
                                                                                    <img  style="width: 18px;"src="{% static 'images/gender-female.png' %}" style="margin-left: 10px;">
                                                                                {% elif commission.case.publisher.gender == 1 %}
                                                                                    {% load static %}
                                                                                    <img style="width: 18px;"src="{% static 'images/gender-male.png' %}" style="margin-left: 10px;">
                                                                                {% else %}
                                                                                    {% load static %}
                                                                                    <img style="width: 18px;"src="{% static 'images/gender-male-female.png' %}" style="margin-left: 10px;">
                                                                                {% endif %}
                                                                            </a>
                                                                        
                                                                            <div class="w-100">
                                                                                <span style="color: rgb(142,145,147);font-size: 12px;line-height: 0px;" id="t{{commission.case.publisher.account_mail}}{{ commission.case.case_id }}">
                                                                                    上次登入: {{commission.case.publisher.django_user.last_login}}
                                                                                    <script> 
                                                                                        var oriTime = "{{commission.case.publisher.django_user.last_login}}"
                                                                                        var ouputId = "t{{commission.case.publisher.account_mail}}{{ commission.case.case_id }}"
                                                                                        changeTime(oriTime, ouputId ,"user");
                                                                                    </script>
                                                                                </span>
                                                                            </div>
                                                                        </div>
                                                                    </td>
                                                                    
                                                                    <td id="contact_t{{commission.case.publisher.account_mail}}{{ commission.case.case_id }}"style="text-align: left; line-height: 58px;width: 200px;color: rgb(85,58,58);">
                                                                    
                                                                        {% if contact != None %}
                                                                            {{commission.case.publisher.contact}}
                                                                        {% else %}
                                                                            {{commission.case.publisher.account_mail}}
                                                                        {% endif %}
                                                                    
                                                                        {% load static %}
                                                                        <!-- copy -->
                                                                        <button onclick="copy('contact_t{{commission.case.publisher.account_mail}}{{ commission.case.case_id }}')" class="btn btn-primary d-none d-lg-block" type="button" style="background: rgba(13,110,253,0);color: rgb(38, 29, 29);border-style: none;width: 30px;height: 30px;margin-top: -50px;margin-left: 130px;"><img src="{% static 'images/Content%20copy.png' %}"></button>
                                                                    </td>
                                                                    <!-- 檢舉、追蹤 -->
                                                                    <td style="white-space: nowrap;width: 250px; overflow: hidden; text-overflow: ellipsis; line-height: 53px;">
                                                                        {% if canReport %}
                                                                            {% if commission.case.publisher.nickname != "" %}
                                                                                <button class="btn btn-primary" id="button-user-report" type="button" data-bs-toggle="modal" data-bs-target="#reportModal" user-name="{{commission.case.publisher.nickname}}" case-name="{{commission.case.title}}" data-user="{{ commission.case.publisher.user_id }}" data-case="{{ commission.case.case_id }}" style="background: transparent;color: transparent;border-style: none;width: 30px;padding: 0px 0px;padding-right: 0px;padding-left: 0px;height: 30px;"><img src="{% static 'images/Report%20problem.png' %}" style="padding-top: 0px;"><span class="text-truncate" style="font-size:14px;color: rgb(75, 49, 42);"> 檢舉</span></button>
                                                                            {% else %}
                                                                                <button class="btn btn-primary" id="button-user-report" type="button" data-bs-toggle="modal" data-bs-target="#reportModal" user-name="{{commission.case.publisher.name}}" case-name="{{commission.case.title}}" data-user="{{ commission.case.publisher.user_id }}" data-case="{{ commission.case.case_id }}" style="background: transparent;color: transparent;border-style: none;width: 30px;padding: 0px 0px;padding-right: 0px;padding-left: 0px;height: 30px;"><img src="{% static 'images/Report%20problem.png' %}" style="padding-top: 0px;"><span class="text-truncate" style="font-size:14px;color: rgb(75, 49, 42);"> 檢舉</span></button>
                                                                            {% endif %}
                                                                        {% else %}
                                                                        <button class="btn " disabled="disabled" id="button-user-report" type="button" style="font-size: 14px;background: rgba(13,110,253,0);color: rgb(38, 29, 29);border-style: none;width: 30px;padding: 0px 12px;padding-right: 0px;padding-left: 0px;height: 30px;">
                                                                            <i class="material-icons" style="font-size: 14px;">report_problem</i> 已檢舉
                                                                        </button>
                                                                        {% endif %}
                                                                    </td>
                                                                    <td  style="width: 200px;"> </td>
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr> 
                                    </tbody>
                                {% endfor %}
                            </table>
                        </div>
                    </div>

<!-- registration take_sign -->
                    <div id="take_sign" style="display: none;">
                        <div class="table-responsive" style="margin-left: 40px;margin-right: 40px; margin-top: -10px;margin-bottom: 50px;background-color: rgb(226, 218, 212); border-radius: 27px;border: 1px solid rgb(125,105,105);">
                            <table style="margin-top: 0px; margin-bottom: 23px;" class="table table-sm table-striped table-borderless ">
                                <thead style="color: rgb(75, 49, 42);padding-top: 0px;">
                                    <tr>
                                        <td style="width: 50px;"></td>
                                        <td style="width: 120px;">結束時間</td>
                                        <td style="width: 200px;">案件名稱</td>
                                        <td style="width: 200px;text-align: center;">報酬</td>
                                        <td style="width: 120px;text-align: center;">動作</td>
                                    </tr>
                                </thead>
                                <tbody class="table-light">
                                    {% for willing in willingness %}
                                        <tr>
                                            <td style="width: 50px;"></td>
                                            <td style="color: rgb(121, 110, 110);line-height: 50px; width: 120px;"id="enddate{{ willing.apply_case.case_id }}">
                                                {{willing.apply_case.ended_datetime}}
                                                <script> 
                                                    var oriTime = "{{willing.apply_case.ended_datetime}}"
                                                    var ouputId = "enddate{{ willing.apply_case.case_id }}"
                                                    changeTime(oriTime, ouputId ,"s");
                                                </script>
                                            </td>
                                            
                                            <td style="width: 200px;">
                                                <a class="case_title" href="{% url 'case-profile' willing.apply_case.case_id %}" style="line-height: 50px;padding-bottom: 0px;">
                                                    <span class="d-inline-block text-truncate" style="max-width: 200px;">{{willing.apply_case.title}}</span>
                                                </a>
                                            </td>
                                            <td style="width: 200px;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;text-align: center;line-height: 50px;color: rgb(121, 110, 110);">{{willing.apply_case.reward}}</td>
                                            <td style="width: 120px;text-align: center;line-height: 50px">
                                                <button class="btn btn-primary" type="button" onclick="sendDele()" value="取消報名" style="width: 100px;height: 24px;font-size: 12px;line-height: 10px;background: #ca6c38;border-style: none;">取消報名</button>
                                                <script>
                                                    function sendDele(){
                                                        if(confirm('確定取消報名？') == true){
                                                            window.location='/toolfamily/user/cancel/{{willing.apply_case.case_id}}'
                                                            // user
                                                        }
                                                    }   
                                                </script>
                                            </td>
                                            
                                        </tr>
                                    {% endfor%}
                                </tbody>
                            </table>
                        </div>
                    </div>
<!-- History -->
                    <div id="take_his" style="display: none;">
                        <div class="d-none d-xl-block table-responsive" style="margin-left: 40px;margin-right: 40px;margin-top: 5px;">
                            <table class="table table-borderless">
                                <tbody>
                                    <tr>
                                        <td style="width: 80px;"></td>
                                        <!-- <button class="btn btn-primary" type="button" style="background: rgba(13,110,253,0);color: rgb(142,93,78);border-style: none;width: 30px;padding: 0px 0px;padding-right: 0px;padding-left: 0px;height: 30px;">↓</button> -->
                                        <td style="width: 150px;">結束時間</td>
                                        <td style="width:350px;">案件名稱</td>
                                        <td style="width: 150px;">報酬</td>
                                        <td style="text-align: center; width: 180px;">狀態</td>
                                        {% load static %}
                                        <td style="text-align: center;width: 185px;">獲得的評價</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="table-responsive"style="margin-top: -19px;margin-left: 40px;margin-right: 40px;margin-bottom: 50px; background: rgba(244, 244, 243, 1);border-radius: 27px;border: 1px solid rgb(125,105,105);">
                            <table style="margin-top: 7px;" class="table table-borderless">
                                {% for commission,canReport in close %}
                                <tbody>
                                    <tr>
                                        {% load static %}
                                        <td style="width: 80px;padding-right: 0px;padding-left: 20px;padding-bottom: 0px;">
                                            <button class="btn btn-primary" onclick="changeImage('{{ commission.case.case_id }}')" type="button" data-bs-toggle="collapse" data-bs-target="#M{{ commission.case.case_id }}" aria-expanded="false" aria-controls="M{{ commission.case.case_id }}"  style="line-height: 45px; background: rgba(13,110,253,0);color: rgb(38, 29, 29);border-style: none;">
                                                <img id="{{ commission.case.case_id }}" src="{% static 'images/Vector2.png' %}">
                                            </button>
                                        </td>
                                        <td style="line-height: 50px;color: rgb(121, 110, 110);width: 150px;padding-bottom: 0px;" id="enddate{{ commission.case.case_id }}">
                                            {{commission.case.ended_datetime}}
                                            <script> 
                                                var oriTime = "{{commission.case.ended_datetime}}"
                                                var ouputId = "enddate{{ commission.case.case_id }}"
                                                changeTime(oriTime, ouputId ,"s");
                                            </script>
                                        </td>
                                        <td style="white-space: nowrap;overflow: hidden;text-overflow: ellipsis;width: 350px;">
                                            {% comment %} {% url 'case-profile' commission.case.case_id %}{% endcomment %}
                                            <a class="case_title" href="{% url 'case-profile' commission.case.case_id %}" style="line-height: 50px;padding-bottom: 0px;">
                                                <span class="d-inline-block text-truncate" style="max-width: 200px;">{{commission.case.title}}</span>
                                            </a>
                                        </td>
                                        <td style="width: 150px;line-height: 50px;color: rgb(121, 110, 110); padding-bottom: 0px;">{{commission.case.reward}}</td>
                                        {% if commission.user_status.status_id == 3 %}
                                            <td style="white-space: nowrap;overflow: hidden;text-overflow: ellipsis;padding-top: 20px; width: 180px;text-align: center;">完成</td>
                                        {% elif commission.user_status.status_id == 4 %}
                                            <td style="white-space: nowrap;overflow: hidden;text-overflow: ellipsis;width: 180px;padding-top: 20px;text-align: center;">解除</td>
                                        {% endif %}
                                        <td style="white-space: nowrap;width: 185px;overflow: hidden;text-overflow: ellipsis;text-align: center;line-height: 50px;">
                                            <span id="starth{{ commission.case.case_id }}">
                                                {{commission.rate_publisher_to_worker}}
                                                <script>
                                                    var starId = "starth{{ commission.case.case_id }}"
                                                    var value = "{{commission.rate_publisher_to_worker}}"
                                                    getStar(starId, value );
                                                </script>
                                            </span>
                                        </td>
                                    </tr>
                                        <tr>
                                            <td colspan="9" style="padding-left: 0px;padding-right: 0px;padding-top: 0px;padding-bottom: 0px; ">
                                                <div class="table-responsive collapse" id="M{{ commission.case.case_id }}">
                                                    <table class="table table-borderless">
                                                        <tbody>
                                                            <tr style="font-size: 12px;background: #ffffff;">
                                                                <td style="white-space: nowrap;overflow: hidden;text-overflow: ellipsis;line-height: 60px; width: 250px;text-align: center;">｜委託人資訊</td>
                                                                    
                                                                <td style="padding-top:20px; line-height: 30px; width: 250px;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;">
                                                                
                                                                    {% if commission.case.publisher.icon %}
                                                                        <div class="img-circular" style="background-image: url({{commission.case.publisher.icon.url}});"></div>
                                                                    {% else %}
                                                                        <div class="img-circular"></div>
                                                                    {% endif %}
                                                                    
                                                                    <div style="margin-left: 55px; margin-top: -50px;">
                                                                        {% comment %} {% url 'others-user-profile' commission.case.publisher.user_id %} {% endcomment %}
                                                                        <a class="link_title" href="{% url 'others-user-profile' commission.case.publisher.user_id %}" >
                                                                            {% if commission.case.publisher.nickname != "" %}
                                                                                {{commission.case.publisher.nickname}}
                                                                            {% else %}
                                                                                {{commission.case.publisher.name}}
                                                                            {% endif %}
                                                                            
                                                                            {% load static %} 
                                                                            {% if commission.case.publisher.gender == 0 %}
                                                                                {% load static %}
                                                                                <img  style="width: 18px;"src="{% static 'images/gender-female.png' %}" style="margin-left: 10px;">
                                                                            {% elif commission.case.publisher.gender == 1 %}
                                                                                {% load static %}
                                                                                <img style="width: 18px;"src="{% static 'images/gender-male.png' %}" style="margin-left: 10px;">
                                                                            {% else %}
                                                                                {% load static %}
                                                                                <img style="width: 18px;"src="{% static 'images/gender-male-female.png' %}" style="margin-left: 10px;">
                                                                            {% endif %}
                                                                        </a>
                                                                    
                                                                        <div class="w-100">
                                                                            <span style="color: rgb(142,145,147);font-size: 12px;line-height: 0px;" id="th{{commission.case.publisher.account_mail}}{{ commission.case.case_id }}">
                                                                                上次登入: {{commission.case.publisher.django_user.last_login}}
                                                                                <script> 
                                                                                    var oriTime = "{{commission.case.publisher.django_user.last_login}}"
                                                                                    var ouputId = "th{{commission.case.publisher.account_mail}}{{ commission.case.case_id }}"
                                                                                    changeTime(oriTime, ouputId ,"user");
                                                                                </script>
                                                                            </span>
                                                                        </div>
                                                                    </div>
                                                                </td>
                                                                
                                                                <td id="contact_th{{commission.case.publisher.account_mail}}{{ commission.case.case_id }}" style="text-align: left; line-height: 58px;width: 280px;color: rgb(85,58,58);">
                                                                    {% if contact != None %}
                                                                        {{commission.case.publisher.contact}}
                                                                    {% else %}
                                                                        {{commission.case.publisher.account_mail}}
                                                                    {% endif %}
                                                                    {% load static %}
                                                                    <!-- copy -->
                                                                    <button onclick="copy('contact_th{{commission.case.publisher.account_mail}}{{ commission.case.case_id }}')" class="btn btn-primary d-none d-lg-block" type="button" style="background: rgba(13,110,253,0);color: rgb(38, 29, 29);border-style: none;width: 30px;height: 30px;margin-top: -50px;margin-left: 130px;"><img src="{% static 'images/Content%20copy.png' %}"></button>
                                                                    <!-- <button onclick="copy('contact_th{{commission.case.publisher.account_mail}}{{ commission.case.case_id }}')" class="btn btn-primary" type="button" style="background: rgba(13,110,253,0);color: rgb(38, 29, 29);border-style: none;width: 30px;height: 30px;padding: 0px 0px;margin-top: -4px;"><img src="{% static 'images/Content%20copy.png' %}"></button> -->
                                                                </td>
                                                                <!-- 追蹤、檢舉 -->
                                                                <td style="white-space: nowrap;width: 250px; overflow: hidden; text-overflow: ellipsis; line-height: 53px;">
                                                                    {% if canReport %}
                                                                        {% if commission.case.publisher.nickname != "" %}
                                                                            <button class="btn btn-primary" id="button-user-report" type="button" data-bs-toggle="modal" data-bs-target="#reportModal" user-name="{{commission.case.publisher.nickname}}" case-name="{{commission.case.title}}" data-user="{{ commission.case.publisher.user_id }}" data-case="{{ commission.case.case_id }}" style="line-height: 1px;background: transparent;color: transparent;border-style: none;width: 30px;padding: 0px 0px;padding-right: 0px;padding-left: 0px;height: 30px;"><img src="{% static 'images/Report%20problem.png' %}"></button>
                                                                            <span class="text-truncate" style="font-size:14px;color: rgb(75, 49, 42);"> 檢舉</span>
                                                                        {% else %}
                                                                            <button class="btn btn-primary" id="button-user-report" type="button" data-bs-toggle="modal" data-bs-target="#reportModal" user-name="{{commission.case.publisher.name}}" case-name="{{commission.case.title}}" data-user="{{ commission.case.publisher.user_id }}" data-case="{{ commission.case.case_id }}" style="line-height: 1px;background: transparent;color:transparent;border-style: none;width: 30px;padding: 0px 0px;padding-right: 0px;padding-left: 0px;height: 30px;"><img src="{% static 'images/Report%20problem.png' %}"></button>
                                                                            <span class="text-truncate" style="font-size:14px;color: rgb(75, 49, 42);"> 檢舉</span>
                                                                        {% endif %}
                                                                    {% else %}
                                                                    <button class="btn justify-content-center align-items-center" disabled="disabled" id="button-user-report" type="button" style="font-size: 14px;width: 30px;padding: 0px 0px;padding-right: 0px;padding-left: 0px;height: 30px;"><i class="material-icons" style="font-size: 14px;">report_problem</i></button>
                                                                    <span class="text-truncate" style="font-size:14px;color: rgb(98, 88, 85);"> 已檢舉</span>
                                                                    {% endif %}
                                                                </td>
                                                                {% if commission.user_status.status_id == 3 %}
                                                                    <td class="d-block" style="width: 200px;padding-left: 55px;line-height: 56px;color: rgb(85,58,58);">
                                                                        {% if commission.rate_worker_to_publisher %}
                                                                            <span style="font-size: 16px;" id="starth{{commission.case.publisher.account_mail}}{{ commission.case.case_id }}">
                                                                                 {{commission.rate_worker_to_publisher}}
                                                                                <script>
                                                                                    var starId = "starth{{commission.case.publisher.account_mail}}{{ commission.case.case_id }}"
                                                                                    var value = "{{commission.rate_worker_to_publisher}}"
                                                                                    getStar(starId, value );</script>
                                                                            </span>&nbsp; 評價
                                                                        {% else %}
                                                                            <form action="/toolfamily/user/rate/" method="post" onSubmit="return confirm('確定送出評價？');">
                                                                                <label>&nbsp; &nbsp;評價</label>
                                                                                {% csrf_token %}
                                                                                <fieldset class="rating">
                                                                                    <input type="submit" id="field{{commission.case.publisher.account_mail}}{{ commission.case.case_id }}_star5" name="{{commission.commissionrecord_id}}" value="5" /><label class = "full" for="field{{commission.case.publisher.account_mail}}{{  commission.case.case_id  }}_star5"></label>
                                                                                    <input type="submit" id="field{{commission.case.publisher.account_mail}}{{ commission.case.case_id }}_star4" name="{{commission.commissionrecord_id}}" value="4" /><label class = "full" for="field{{commission.case.publisher.account_mail}}{{  commission.case.case_id  }}_star4"></label>
                                                                                    <input type="submit" id="field{{commission.case.publisher.account_mail}}{{ commission.case.case_id }}_star3" name="{{commission.commissionrecord_id}}" value="3" /><label class = "full" for="field{{commission.case.publisher.account_mail}}{{  commission.case.case_id  }}_star3"></label>
                                                                                    <input type="submit" id="field{{commission.case.publisher.account_mail}}{{ commission.case.case_id }}_star2" name="{{commission.commissionrecord_id}}" value="3" /><label class = "full" for="field{{commission.case.publisher.account_mail}}{{  commission.case.case_id  }}_star2"></label>
                                                                                    <input type="submit" id="field{{commission.case.publisher.account_mail}}{{ commission.case.case_id }}_star1" name="{{commission.commissionrecord_id}}" value="1" /><label class = "full" for="field{{commission.case.publisher.account_mail}}{{  commission.case.case_id  }}_star1"></label>
                                                                                </fieldset>
                                                                            <form>
                                                                        {% endif %}
                                                                    </td>
                                                                {% elif commission.user_status.status_id == 4 %}
                                                                    <td  class="d-block" style="width: 200px; text-align: center; padding-top: -80px; line-height: 30px;color: rgb(38, 86, 56);;" id="deleh{{ commission.case.case_id }}">
                                                                        已於 {{commission.doublecheck_datetime}}解除案件
                                                                        <script>
                                                                            var oriTime = "{{commission.doublecheck_datetime}}"
                                                                            var ouputId = "deleh{{ commission.case.case_id }}"
                                                                            changeTime(oriTime, ouputId, "dele");
                                                                        </script> 
                                                                    </td>
                                                                {% endif %}
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </td>
                                        </tr> 
                                    </tbody>
                                {% endfor %}
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% if messages %}
    {% for message in messages %}
        {% if 'origin_case' in message.extra_tags %}
           <!-- <p style="color: #ca6c38;"> {{ message }} </p> -->
           <script>
            if( '{{ message }}' != ''){
                $("#B{{ message }}").attr('aria-expanded','true');
                changeImage('{{ message }}'); 
                $("#M{{ message }}").removeClass('collapse').addClass('collapse show');
            }
            </script>
        {% elif 'origin_page' in message.extra_tags %}
        <!-- {{ message }} -->
            <script>
            if( '{{ message }}' != ''){
                changePage('{{ message }}');
            }
            </script>
        {% endif %}
    {% endfor %}
    {% endif %}
</body>
{% endblock %}

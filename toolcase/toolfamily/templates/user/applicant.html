{% extends "base_generic.html" %}
<!DOCTYPE html>
<html lang="en">
{% block sidebar %}
    <div class="col-md-6 d-none d-md-block" style="width: 192px;margin-top: 80px;">
        <ul class="list-group">
            <li class="list-group-item" style="background: rgb(241,241,241);text-align: center;font-size: 12px;border-bottom-style: none;"><a href="#" style="color: rgb(134, 81, 64);text-align: center;font-size: 16px;">會員中心</a></li>
            <li class="list-group-item" style="color: rgb(134, 81, 64);background: rgb(241,241,241);text-align: center;font-size: 16px;border-bottom-style: none;"><a href="#" style="color: rgb(134, 81, 64);background: rgb(241,241,241);text-align: center;font-size: 16px;">編輯個人資訊</a></li>
            <li class="list-group-item" style="color: rgb(134, 81, 64);background: rgb(241,241,241);text-align: center;font-size: 16px;border-bottom-style: none;"><a href="#" style="color: rgb(134, 81, 64);background: rgb(241,241,241);text-align: center;font-size: 16px;">我的委託</a></li>
            <li class="list-group-item" style="color: rgb(134, 81, 64);background: rgb(241,241,241);text-align: center;font-size: 16px;border-bottom-style: none;"><a href="#" style="color: rgb(134, 81, 64);background: rgb(241,241,241);text-align: center;font-size: 16px;">我的接案</a></li>
            <li class="list-group-item" style="color: rgb(134, 81, 64);background: rgb(241,241,241);text-align: center;font-size: 16px;border-bottom-style: none;"><a href="#" style="color: rgb(134, 81, 64);background: rgb(241,241,241);text-align: center;font-size: 16px;">我的追蹤</a></li>
            <li class="list-group-item" style="color: rgb(134, 81, 64);background: rgb(241,241,241);text-align: center;font-size: 16px;border-bottom-style: none;"><a href="#" style="color: rgb(134, 81, 64);background: rgb(241,241,241);text-align: center;font-size: 16px;">設定</a></li>
            <li class="list-group-item" style="color: rgb(134, 81, 64);background: rgb(241,241,241);text-align: center;font-size: 16px;"><a href="#" style="color: rgb(134, 81, 64);background: rgb(241,241,241);text-align: center;font-size: 16px;">登出</a></li>
        </ul>
    </div>
{% endblock %}
<script src="/static/bootstrap/js/bootstrap.min.js"></script>

{% block content %}
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>台大工具箱</title>
    <link rel="stylesheet" href="/static/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="/static/fonts/material-icons.min.css">
    <link rel="stylesheet" href="/static/css/take-styles.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

<style>
    /* address style */
    a.link_title:link{
    color:rgba(134, 81, 64);
    text-decoration: none;
    }
    a.link_title:visited{
    color:rgba(134, 81, 64);
    }
    a.link_title:hover{
    color:rgb(204,195,190);
    }

    /* star */
    .checked {
    color: #f3d16d;
    }
    .unchecked {
    color: #f3d16d;
    }
    .helfchecked {
    color: #f3d16d;
    }
    fieldset, label { margin: 0; padding: 0; }
    body{ margin: 20px; }
    h1 { font-size: 1.5em; margin: 10px; }
</style>

<script>
    function msToTime(ms) {
        let seconds = (ms / 1000).toFixed(0);
        let minutes = (ms / (1000 * 60)).toFixed(0);
        let hours = (ms / (1000 * 60 * 60)).toFixed(0);
        let days = (ms / (1000 * 60 * 60 * 24)).toFixed(0);
        if (seconds < 60) return seconds + " 秒";
        else if (minutes < 60) return minutes + " 分";
        else if (hours < 24) return hours + " 小時";
        else return days + " 天"
    }
    function getStar(starId,value){
        var stringA = "<span class='fa fa-star checked'></span>"
        var stringB = "<span class='fa fa-star-o unchecked'></span>"
        var stringC = "<span class='fa fa-star-half-o helfchecked'></span>"
        var result = ""
        valueInt = parseInt(value)
        for (i = 0; i < valueInt; i++){
            result= result+stringA
        }
        if ((value-valueInt)!=0){
            result= result+stringC
        }
        var los = 5-Math.ceil(value)
        for(j = 0; j<los; j++){
            result = result+stringB
        }

        document.getElementById(starId).innerHTML=result
    }
</script>

<body style="background: rgb(244,244,243);">
    <div class="container" style="width: 1317px;">
        
        <div class="row" style="width: 1222px;margin-right: 30px;margin-right: 30px;">
            <div class="col-md-6" style="width: 1027px; border-bottom-style: none;margin-top: 80px; padding-right: 0px;padding-left: 0px;">
                {% load static %}
                <div class="border rounded" style="background: #ffffff;width: 990px;margin-left: 22px;box-shadow: 1px 1px rgba(191,191,191,0.81);"><img src="{% static 'images/Ellipse%204.png' %}" style="margin-top: 50px;margin-left: 405px;">
                    <h1 class="fw-bold text-center" style="color: rgb(94, 73, 73);margin-top: -52px;font-size: 30px;">應徵名單</h1>
                    {% load static %}
                    <div style= "margin-top: -50px; margin-left: -3px;width: 300px;">
                        <img src="{% static 'images/back.png' %}">
                        <ul style="color: rgba(134, 81, 64, 1); margin-top: -50px;margin-bottom: 0px;">
                            <li style="font-size: 14px;">委託編號 #{{case.case_id}}</li>
                            <li style="font-size: 14px;">委託標題 {{case.title}}</li>
                        </ul>
                    </div>

                    <div class="underlineEffects" style="margin-top: -5px;width: 523px;">
                        <ul style="margin-left: 40px;margin-bottom: 0px;">
                            <li><a href="{% url 'user-publish-record' %}">回我的委託</a></li>
                        </ul>
                    </div>
                    
                    <div class="underlineEffects" style="margin-left: 600px; margin-top: -5px;">
                        <ul style="color: rgb(94, 73, 73); margin-bottom: 0px;">
                            <li style="font-size: 14px;">已有 {{cnt}} 個工具人，最多再選取 {{last}} 人 &nbsp;&nbsp;</li>
                            <li style="font-size: 14px;">
                                <form action="/toolfamily/user/build/" onSubmit="return confirm('確定送出委託?');" method="post">
                                    {% csrf_token %}
                                    <button class="btn btn-primary" type="submit" id="send" style="height: 24px;font-size: 14px;line-height: 10px;background: #7b3b20;border-style: none;">送出</button>
                                    <button class="btn btn-primary" type="reset" id="reset" style="height: 24px;font-size: 14px;line-height: 10px;border-color: #7b3b20;background: rgba(13,110,253,0);color: #7b3b20;">重置</button>
                                </form>
                            </li>
                        </ul>
                    </div>
                    <!-- {% comment %} 剩餘人數0的時候還沒擋 {% endcomment %}-->
                
                    <div style="width: 892px; margin-left: 50px;margin-right: 50px;margin-bottom: 50px;background-color: rgba(226, 218, 212, 1); border-radius: 27px;border: 1px solid rgb(125,105,105);">
                        <table style="margin-top: 0px; margin-bottom: 23px;" class="table table-striped table-borderless">
                            <thead style="color: rgb(75, 49, 42);">
                                <tr>
                                    <td style="width: 80.297px;"></td>
                                    <td style="width: 200px;">工具人資訊</td>
                                    <td colspan="2" style="width: 300px;"><button class="btn" type="button" style="color: rgb(75, 49, 42); width: 120px;height: 30px;">↑ 評價</button></td>
                                    
                                    <td colspan="2" style="width: 100px;">狀態</td>
                                    <td colspan="2" style="width: 150px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 動作</td>
                                </tr>
                            </thead>
                                
                            <!-- content -->
                            <tbody class="table-light">
                                {% for data in willingness %}
                                    <tr>
                                        <td style="width: 80.297px;padding-right: 10px;padding-left: 10px;">
                                            {% if data.willing_user.icon %}
                                                <img class="rounded-circle" src="{{data.willing_user.icon.url}}" style="width: 43px;margin-left: 11px;">
                                            {% endif %}
                                        </td>
                                        <td style="font-size: 14px; line-height: 16px;color: rgb(121, 110, 110);width: 200px;">
                                            <a class="link_title" href="#" style="line-height: 30px;">{{data.willing_user.name}}
                                                {% load static %} 
                                                {% if data.willing_user.gender == 0 %}
                                                    {% load static %}
                                                    <img  style="width: 18px;"src="{% static 'images/gender-female.png' %}" style="margin-left: 10px;">
                                                {% elif data.willing_user.gender == 1 %}
                                                    {% load static %}
                                                    <img style="width: 18px;"src="{% static 'images/gender-male.png' %}" style="margin-left: 10px;">
                                                {% else %}
                                                    {% load static %}
                                                    <img style="width: 18px;"src="{% static 'images/gender-male-female.png' %}" style="margin-left: 10px;">
                                                {% endif %}
                                            </a>
                                            <div class="w-100">
                                                <span style="color: rgb(142,145,147);font-size: 12px;line-height: 0px;" id="a{{data.willing_user.account_mail}}{{ case.case_id }}">上次登入: {{data.willing_user.django_user.last_login}}
                                                    <script> 
                                                        var oriTime = "{{data.willing_user.django_user.last_login}}"
                                                        var yyyy = oriTime.split('年')[0]
                                                        var mm = oriTime.split('年')[1].split('月')[0]
                                                        var dd = oriTime.split('年')[1].split('月')[1].split('日')[0]
                                                        var tt = oriTime.split('年')[1].split('月')[1].split('日 ')[1]
                                                        
        
                                                        var enddate = new Date(mm + '/' + dd + '/' + yyyy + ' '+ tt)
                                                        var currentdate = new Date();
                                                        var remainday = Math.abs((enddate.getTime() - currentdate.getTime()))
                                                        
                                                        document.getElementById("a{{data.willing_user.account_mail}}{{ case.case_id }}").innerHTML="上次登入: "+ msToTime(remainday)+"前";
                                                        
                                                        
                                                    </script>
                                                </span>
                                            </div>
                                        </td>
                                        <td style="width: 300px; font-size: 14px; color: rgb(85,58,58); padding-top: 20px;">
                                            評價：
                                            <span id="starapp{{data.willing_user.account_mail}}{{ case.case_id }}">
                                                <script>
                                                    var starId = "starapp{{data.willing_user.account_mail}}{{ case.case_id }}"
                                                    var value = " {{data.willing_user.rate}}"
                                                    getStar(starId, value );
                                                </script>
                                            </span>
                                        </td>
                                        <td colspan="2" style="width: 100px;line-height: 43px;color: rgb(121, 110, 110);" class="select" id="text_{{data.casewillingness_id}}">未選</td>
                                        
                                        <td colspan="2" style="width: 150px;line-height: 40px;padding-bottom: 0px;">
                                            <input type="button" class=" btn_select btn btn-primary " value="選擇" id="{{data.casewillingness_id}}" type="button" style="width: 100px;height: 24px;font-size: 12px;line-height: 10px;background: #ca6c38;border-style: none;">
                                        </td>
                                    </tr>
                                {% endfor%}
                            </tbody>
                        </table>

                        <script>
                        
                        if ({{last}}==0){
                            $("input").attr('disabled',true);
                            $("#send").attr('disabled',true);
                        }
                        function check(count,id){
                            if (count>{{last}}){ 
                                $("input").attr('disabled',true);
                                $("#"+ num).attr('disabled',false);
                            }else{
                                $("input").attr('disabled',false);
                            }
                            if(count != 0){
                                $("#send").attr('disabled',false);
                            }else{
                                $("#send").attr('disabled',true);
                            }
                        }
                        count = 0;
                        check(count,"");
                        $(".btn_select").click(function() {
                            num = $(this).attr("id");
                            if ($(this).attr("value") == "選擇") {
                                count++;
                                $(this).val("取消");
                                $(this).css("background", "#7b3b20")
                                $("#text_" + num).html("已選");
                                $("<input>").attr({
                                    type: "hidden",
                                    id: "content" + num,
                                    class: "toolman",
                                    name: "toolman",
                                    value: num,
                                }).appendTo("form");
                            }
                            else {
                                count--;
                                $(this).val("選擇");
                                $(this).css("background", "#ca6c38")
                                $("#text_" + num).html("未選");
                                $("#content" + num).remove();
                            }
                            check(count,num);

                            
                        });

                        $("#reset").click(function() {
                            $(".toolman").remove();
                            $(".select").html("未選");
                            $(".btn_select").val("選擇")
                            $(".btn_select").css("background", "#ca6c38")
                            count = 0;
                            check(count,num);
                        });
                        </script>

                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
{% endblock %}
</html>
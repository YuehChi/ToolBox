{% extends "base_generic.html" %}
{% block content %}

{% if alert %}
    <script type="text/javascript">
        alert({{erro|safe}});
    </script>
{% endif %}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>case-search</title>
    <link rel="stylesheet" href="\static\bootstrap\css\bootstrap.min.css">
    <link rel="stylesheet" href="\static\fonts\material-icons.min.css">
    <link rel="stylesheet" href="\static\css\case-search-styles.css">
    <link rel="stylesheet" href="\static\css\search-bar-styles.css">

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script src="\static\js\case-search.js"></script>
    <script src="\static\js\search-bar.js"></script>
</head>

<body class="cn_font en_font" style="background: #f4f4f3;">
        
    <!----------Image Board---------->
    <div class="container" style="margin-top: 50PX;height: 100px;width: 100%;margin-right: 0px;margin-left: 0px;padding-right: 0px;padding-left: 0px;max-width: none;">
        <div class="row" style="height: 100px;width: 100%;margin: 0px;">
            <div class="col" style="height: 100px;width: 100%;padding: 0px;">
                <img src="\static\images\ntu_1.png" style="width: 100%;height: 100px;"></div>
        </div>
    </div>

    <!----------Search Bar---------->
    <form class = "from"  action="" enctype="multipart/form-data" method="POST" id="search-form">
        {% csrf_token %}
        <input class="d-none" type="checkbox" name="case_field" id="forminput-case-field">
        <input class="d-none" type="checkbox" name="case_type" id="forminput-case-type">
        <input class="d-none" type="text" name ="case_query" id="forminput-case-query">
        <input class="d-none" type="submit" id="search-submit" >

        <div class="container  d-flex justify-content-end" style="margin-top: 50px;"">
            <div class="row">
                <div class="col" style="align-items: flex-end; line-height: 40px;">
                    <div id="div-search-allcase">
                        <a class="main-color" href="#" id="link-search-allcase">全部案件</a>
                    </div>
                </div>

                <div class="col">
                    <div class="dropdown search-dropdown show" id="dropdown-field">
                        <a class="btn dropdown-toggle main-color"  role="button" id="dropdownlink-field" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        找領域
                        </a>
                        <div class="dropdown-menu search-dropdown-menu" aria-labelledby="dropdownlink-field">
                        <a class="dropdown-item a-search a-search-field" href="#" data-value="1">電資</a>
                        <a class="dropdown-item a-search a-search-field" href="#" data-value="2">數理</a>
                        <a class="dropdown-item a-search a-search-field" href="#" data-value="3">人文科學</a>
                        <a class="dropdown-item a-search a-search-field" href="#" data-value="4">藝術設計</a>
                        <a class="dropdown-item a-search a-search-field" href="#" data-value="5">其他</a>

                        </div>
                    </div>
                </div>

                <div class="col">
                    <div class="dropdown search-dropdown show" id="dropdown-type">
                        <a class="btn dropdown-toggle a-search"  role="button" id="dropdownlink-type" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        找類型
                        </a>
                        <div class="dropdown-menu search-dropdown-menu" aria-labelledby="dropdownlink-type">
                        <a class="dropdown-item a-search a-search-type" href="#" data-value="1">諮詢</a>
                        <a class="dropdown-item a-search a-search-type" href="#" data-value="2">家教</a>
                        <a class="dropdown-item a-search a-search-type" href="#" data-value="3">勞力</a>
                        <a class="dropdown-item a-search a-search-type" href="#" data-value="4">實驗</a>
                        <a class="dropdown-item a-search a-search-type" href="#" data-value="5">其他</a>

                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="keyword_wrap search-div">
                        <input id="search-keyword" type="text" class="keyword_input" placeholder="輸入委託關鍵字" value="">
                        <div class="clear_search_icon" style="display: none;">
                            <i class="material-icons">search</i>
                        </div>
                        <a href="#" id="link-search-keyword">
                            <i class="material-icons keyword_icon">search</i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </form>
    <hr class="d-lg-flex" style="width: 95%;margin: auto;margin-right: 20px;margin-left: 20px;margin-top: 0px;opacity: 1;border-color: #5e4949;color: #5e4949;">


    
    <div class="container mt-5 mb-5">
        <div class="row">
            <div class="col-12 col-md-3">
                <form class="from"  action=" " enctype="multipart/form-data" method="POST"  id="advanced-search-form">
                    {% csrf_token %}
                    <input class="d-none" type="text" name ="case_query" id="advanced-search-case-query">
                    <input class="d-none" name="query_list" id="forminput-caselist" >
                    <input class="d-none" id="forminput-num" type="number" name ="num">
                    <input class="d-none" id="forminput-date" type="date" name ="date_time" >
                    <input class="d-none" id="forminput-work" type="number" name ="work" >
                    <input class="d-none" id="forminput-constraint" type="text" name ="constraint">
                    <input class="d-none" id="forminput-location" type="text" name ="location">
                    <input class="d-none" id="forminput-con" type="text" value="1" name="con">
                    <input class="d-none" id="advanced-search-submit" type="submit">

                    
                    <span class="d-block" id="get-input-casetype">{{type_value}}</span>
                    <span class="d-block" id="get-input-casefield">{{field_value}}</span>
                    <span class="d-block" id="get-input-caselist">{{query_list}}</span>

                    {% for t in type %}
                    <span class="d-block" id="get-input-type">{{t}}</span>
                    {% endfor %}

                    {% for f in field %}
                    <span class="d-block" id="get-input-field">{{f}}</span>
                    {% endfor %}
                    <span class="d-block" id="get-input-num">{{num}}</span>
                    <span class="d-block" id="get-input-enddate">{{date_time}}</span>
                    <span class="d-block" id="get-input-work">{{work}}</span>
                    <span class="d-block" id="get-input-constraint">{{constraint}}</span>
                    <span class="d-block" id="get-input-location">{{location}}</span>



                    <div class="card">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-12">
                                    <span style="font-weight: bold;color: #865140;padding-left: 10px;">
                                    進階搜尋
                                    </span>
                                </div>
                                <div class="col-12 search-col mt-3">
                                    <span class="d-block" style="font-size: 14px;">
                                    領域
                                    </span>
                                    <div style="height: auto;display: inline;font-size: 12px!important;">
                                        <div class="form-check form-check-inline" style="height: auto;margin-bottom: 0px;">
                                            <input class="form-check-input" type="checkbox" id="check-field-1" value="1" name="field" style="border-color: #865140;">
                                            <label class="form-check-label" for="check-field-1">
                                            電資
                                            </label>
                                        </div>
                                        <div class="form-check form-check-inline" style="height: 13px;">
                                            <input class="form-check-input" type="checkbox" id="check-field-2" value="2" name="field" style="border-color: #865140;">
                                            <label class="form-check-label" for="check-field-2">
                                            數理
                                            </label>
                                        </div>
                                        <div class="form-check form-check-inline" style="height: auto;">
                                            <input class="form-check-input" type="checkbox" id="check-field-3" value="3" name="field" style="border-color: #865140;">
                                            <label class="form-check-label" for="check-field-3">
                                            人文科學
                                            </label>
                                        </div>
                                        <div class="form-check form-check-inline" style="height: 20px !important;margin-bottom: 0px;min-height: 18px;">
                                            <input class="form-check-input" type="checkbox" id="check-field-4" value="4" name="field" style="color: #865140;border-color: #865140;">
                                            <label class="form-check-label" for="check-field-4">
                                            藝術設計
                                            </label>
                                        </div>
                                        <div class="form-check form-check-inline" style="border-color: rgb(134, 81, 64);">
                                            <input class="form-check-input" type="checkbox" id="check-field-5" value="5" name="field" style="border-color: #865140;">
                                            <label class="form-check-label" for="check-field-5">
                                            其他
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-12 search-col mt-3">
                                    <span class="d-block" style="font-size: 14px;">
                                    類型
                                    </span>
                                    <div style="height: auto;/*inline-height: 10px;*/display: inline;font-size: 12px!important;">
                                        <div class="form-check form-check-inline" style="height: auto;margin-bottom: 0px;">
                                            <input class="form-check-input" type="checkbox" id="check-type-1" value="1" name="type" style="border-color: #865140;">
                                            <label class="form-check-label" for="check-type-1">
                                            諮詢
                                            </label>
                                        </div>
                                        <div class="form-check form-check-inline" style="height: 13px;">
                                            <input class="form-check-input" type="checkbox" id="check-type-2" value="2" name="type" style="border-color: #865140;">
                                            <label class="form-check-label" for="check-type-2">
                                            家教
                                            </label>
                                        </div>
                                        <div class="form-check form-check-inline" style="height: auto;">
                                            <input class="form-check-input" type="checkbox" id="check-type-3" value="3" name="type" style="border-color: #865140;">
                                            <label class="form-check-label" for="check-type-3">
                                            勞力
                                            </label>
                                        </div>
                                        <div class="form-check form-check-inline" style="height: 20px !important;margin-bottom: 0px;min-height: 18px;">
                                            <input class="form-check-input" type="checkbox" id="check-type-4" value="4" name="type" style="color: #865140;border-color: #865140;">
                                            <label class="form-check-label" for="check-type-4">
                                            實驗
                                            </label>
                                        </div>
                                        <div class="form-check form-check-inline" style="border-color: rgb(134, 81, 64);">
                                            <input class="form-check-input" type="checkbox" id="check-type-5" value="5" name="type" style="border-color: #865140;">
                                            <label class="form-check-label" for="check-type-5">
                                            其他
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-12 search-col mt-3">
                                    <span class="d-block" style="font-size: 14px;">
                                    徵求人數
                                    </span>
                                    <select class="select form-select-lg" id="select-num" name="select_num" style="outline: none;">
                                        <div class="options">
                                            <option class="item option" value="0">不限</option>
                                            <option class="item" value="1">1 人</option>
                                            <option class="item" value="2">1~5 人</option>
                                            <option class="item" value="3">5~10 人</option>
                                            <option class="item" value="4">10 人以上</option>
                                        </div>
                                    </select>
                                </div>
                                <div class="col-12 search-col mt-3">
                                    <span class="d-block" style="font-size: 14px;">
                                    結束時間
                                    </span>
                                    <select class="select form-select-lg" id="select-enddate" name="select_enddate" style="outline: none;">
                                        <div class="options">
                                            <option class="item option" value="0">不限</option>
                                            <option class="item" value="1">小於三天</option>
                                            <option class="item" value="2">小於一週</option>
                                            <option class="item" value="3">小於一個月</option>
                                            <option class="item" value="4">一個月以上</option>
                                        </div>
                                    </select>
                                </div>
                                <div class="col-12 search-col mt-3">
                                    <span style="font-size: 14px;">
                                    工作方式
                                    </span>
                                    <div style="height: auto;font-size: 12px;">
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="radio" id="radio-workmode-0" name="workmode" value="0" style="border-color: #865140;">
                                            <label class="form-check-label" for="radio-workmode-0">
                                            不限
                                            </label>
                                        </div>
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="radio" id="radio-workmode-1" name="workmode" value="1" style="border-color: #865140;">
                                            <label class="form-check-label" for="radio-workmode-1">
                                            需在現場
                                            </label>
                                        </div>
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="radio" id="radio-workmode-2" name="workmode" value="2" style="border-color: #865140;">
                                            <label class="form-check-label" for="radio-workmode-2">
                                            線上
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-12 search-col mt-3">
                                    <span class="d-block" style="font-size: 14px;">
                                    偏好條件
                                    </span>
                                    <input class="form-control" type="text" id="input-preference" name="input_preference" style="width: 90%;height: 30px;border-color: #7B6363;font-size: 14px;outline: none;" placeholder="不限">
                                </div>
                                <div class="col-12 search-col mt-3">
                                    <span class="d-block" style="font-size: 14px;">
                                    地點
                                    </span>
                                    <input class="form-control" type="text" id="input-location" name="input_location" style="width: 90%;height: 30px;border-color: #7B6363;font-size: 14px;outline: none;" placeholder="不限">
                                </div>
                                
                                <div class="col-12 search-col mt-3 justify-content-end align-items-end text-end">
                                    <button class="btn mt-1 mb-2" type="button" id="button-advanced-search" style="font-size: 14px;background: #865140;color: rgb(255,255,255);width: 80px;margin-right: 10%;">
                                        篩選
                                    </button>
                                </div>

                            </div>
                        </div>
                    </div>
                </form>
            </div>

            <div class="col-12 col-md-9">
                <div class="card">
                    <div class="card-body">
                        <div class="row">
                            <!----------Filter---------->
                            <div class="col-12 flex-wrap">
                                <div class=" align-items-end mt-4" style="height: auto;width: auto;display: flex;align-items: flex-end;">
                                    <img class="decorate-icon" src="/static/images/clipboard-image-1.png">
                                    <div class="d-inline-block" style="height: auto;flex: 1">
                                        <span class="d-lg-flex d-inline-block justify-content-start" style="padding-left: 60px;">
                                        所有案件 ─ 共&nbsp;<span id="case-length" style="color: #865140;">{{ result_case|length }}</span>&nbsp;件<br>
                                        </span>
                                    </div>
                                    <div class="text-end d-inline-block" style="height: auto;width: auto;vertical-align: baseline;">
                                        <select class="select-filter" style="outline: none;">
                                            <option value="1" selected="">1 / 10頁</option>
                                            <option value="2">2 / 10頁</option>
                                            <option value="3">3 / 10頁</option>
                                        </select>
                                        <select class="select-filter" style="margin-left: 10px;outline: none;">
                                            <option value="1" selected="">時間 新→舊</option>
                                            <option value="2">時間 舊→新</option>
                                            <option value="2">追蹤人數</option>
                                            <option value="4">應徵人數</option>
                                        </select>
                                    </div>
                                </div>
                                <hr class="mt-2 mb-0">
                            </div>
                            <!----------Case Card---------->
                            <div id="case-cards">
                                {% for case in result_case%}
                                    <div class="col-12 case-card" id="case-card-{{case.case_id}}">
                                        <span class="d-none filter-num">{{case.num}}</span>
                                        <span class="d-none filter-enddate">{{case.ended_datetime}}</span>


                                        <div class="card case-card case-counter">
                                            <div class="card-body" style="padding-bottom: 5px;">
                                                <div class="row">
                                                    <!----------Applyication Num---------->
                                                    <div class="col-2" style="position: relative;">
                                                        <div class="img-box" style="display: flex!important;align-items: center;position:absolute;">
                                                            <span class="en_font" id="s-apply-num-v" style="font-size: 24px;color: #f4f4f3;position: absolute;left: 33%;top: 15%;">25</span>
                                                            <span id="s-apply-num-t" style="font-size: 12px;color: #f4f4f3;position: absolute;left: 25%;bottom: 20%;">應徵中</span>
                                                        </div>
                                                    </div>


                                                    <!----------Case Main Info---------->
                                                    <div class="col-10 col-md-8">                                                  
                                                    
                                                        <h4 style="color: rgb(38,29,29);font-weight: bold;font-size: 18px;margin-bottom: 0px;width: 90%;">
                                                            <a class="d-none d-xl-block a-title" href="{% url 'case-profile' case.case_id %}" style="color: rgb(38,29,29);">{{case.title|truncatechars_html:25}}</a>
                                                            <a class="d-none d-md-block d-xl-none a-title" href="{% url 'case-profile' case.case_id %}" style="color: rgb(38,29,29);">{{case.title|truncatechars_html:18}}</a>
                                                            <a class="d-md-none d-lg-none d-xl-none a-title" href="{% url 'case-profile' case.case_id %}" style="color: rgb(38,29,29);">{{case.title|truncatechars_html:15}}</a>
                                                        </h4>
                                                        <!----------Second Info---------->
                                                        <div class="mt-1 d-xl-flex d-inline-block align-items-center justify-content-start" style="height: auto;width: 100%;font-size: 10px;">
                                                            <i class="material-icons" style="margin-right: 5px;color: #865140;font-size: 16px;">confirmation_number</i>
                                                            <span style="color: #865140;margin-right: 5px;font-size: 16px;">
                                                            {{case.reward}}
                                                            </span>
                                                            
                                                            <span style="color: #865140;margin-right: 5px;margin-left: 5px;">|</span>
                                                            
                                                            <i class="material-icons" style="margin-right: 5px;color: #865140;font-size: 10px;">people</i>
                                                            <span class="case-mum" id="case-num-{{case.case_id}}" style="margin-right: 5px;color: #865140;">
                                                                {{case.num}}人
                                                            </span>
                                                            
                                                            <span style="margin-left: 5px;margin-right: 5px;color: #865140;">|</span>
                                                            
                                                            <i class="material-icons" style="margin-right: 5px;color: #865140;font-size: 10px;">location_on</i>
                                                            <span style="margin-right: 5px;color: #865140;">
                                                                {{ case.location|truncatechars_html:10 }}
                                                            </span>
                                                            
                                                            <span style="margin-right: 5px;margin-right: 5px;color: #865140;">|</span>
                                                            
                                                            <i class="material-icons" style="margin-right: 5px;color: #865140;font-size: 10px;">build</i>
                                                            <span style="margin-right: 5px;color: #865140;">
                                                                {% if case.work == 1 %}
                                                                需到現場
                                                                {% else %}
                                                                線上
                                                                {%endif%}
                                                            </span>
                                                        </div>

                                                        <!----------Description---------->
                                                        <p class="mt-3 mb-3" id="case-description" style="color: #261d1d;font-size: 14px;height: auto;line-height: 18px;width: 90%;margin-bottom: 10px;">
                                                            {% if case.description == "" %}
                                                                <font color="#746a6a">無案件詳細描述。</font>
                                                            {% else %}
                                                                {{ case.description|truncatechars_html:35 }}
                                                            {% endif %}
                                                        </p>

                                                        <hr style="color: #5e4949;margin-top: 3px;margin-bottom: 3px;">

                                                        <!----------Fields & Types---------->
                                                        {% for case_field in case_fields %}
                                                            {% if case_field.case_id == case.case_id%}
                                                                <a class="d-inline tag" href="#">#{{case_field.case_field.field_name}}</a>
                                                            {%endif%}
                                                        {% endfor %}
                                                        {% for case_type in case_types %}
                                                            {% if case_type.case_id == case.case_id%}
                                                                <a class="d-inline tag" href="#">#{{case_type.case_type.type_name}}</a>
                                                            {%endif%}
                                                        {% endfor %}

                                                        <!----------Bookmark---------->

                                                        <img class="i-case-bookmark" src="/static/images/bookmark-outline-icon.png">
                                                    </div>

                                                    <!----------User Main Info---------->
                                                    <div class="d-lg-flex justify-content-lg-center align-items-lg-start d-none d-md-block col-2 col-md-2">
                                                        <div class="row">
                                                            <!----------User Icon---------->
                                                            <div class="col-12 d-flex justify-content-center align-items-center">
                                                                <div class="text-center">
                                                                    <a href="#">
                                                                        <div class="img-circular" id="user-icon"   style="background-image: url('{{case.publisher.icon.url}}');">
                                                                        </div>
                                                                    </a>
                                                                </div>
                                                            </div>

                                                            <!----------User Rate---------->
                                                            <div class="col-12 d-flex justify-content-center align-items-center" style="margin-top: 3px;">
                                                                <div id="user-rate-{{case.case_id}}" class=" d-flex justify-content-center align-items-center">
                                                                    <script>
                                                                        $('#user-rate-{{case.case_id}}').html(userRate({{case.publisher.rate}}));    // assuming f() is defined in script.js
                                                                    </script>
                                                                </div>
                                                                <span id="user-ratenum" style="color: #865140;font-size: 14px">
                                                                ({{case.publisher.rate_num}})
                                                                </span>
                                                            </div>

                                                            <!----------User Nickname---------->
                                                            <div class="col-12 d-flex justify-content-center align-items-center" style="margin-top: 3px;">
                                                                <span id="user-nickname" style="font-size: 14px;text-align: center;font-weight: bold;">
                                                                {% if user.nickname == "" %}
                                                                    {{case.publisher.name}}
                                                                {% else %}
                                                                    {{case.publisher.nickname}}
                                                                {%endif%}
                                                                </span>
                                        
                                                            </div>

                                                            <!----------User Last Login Time---------->
                                                            <div class="col-12 d-flex justify-content-center align-items-center">
                                                                <span class="justify-content-center align-items-center text-center" id="user-lastlogintime-{{case.case_id}}" style="font-size: 8px;margin-top: 3px;color: #b8b3b3;">
                                                                    <script>
                                                                        $('#user-lastlogintime-{{case.case_id}}').html(userLastLogin('{{case.publisher.last_login}}')); 
                                                                    </script>
                                                                </span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>



                                            </div>
                                        </div>
                                        <hr class="mt-1 mb-0" style="border: none;width: 98%; height: 1px;margin: auto;opacity: 0.5;border-color: #5e4949;color: #5e4949;">
                                    </div>
                                {% endfor%}
                                
                            </div><!----------End Case Card---------->

                            
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</body>

</html>

{% endblock %}